# Story 8.1: Local Preset Save/Load (Inline UI - No Modals)

**Epic:** WLED Preset Management (Paid Feature)
**Status:** ğŸ“ Planning
**Priority:** High
**Complexity:** Medium
**Prerequisite:** Story 6.1 Phase 0 (Unified WLED Device Manager) âœ…

## Brief Description

Enable users to save their current WLED device configurations as named presets and quickly load them later, using **inline UI patterns** (no modals/overlays) and localStorage for initial implementation. This provides the foundation for cloud-synced presets (Story 8.3) while allowing rapid UX iteration without database complexity.

---

## Story

**As a** musician setting up WLED hardware for performances,
**I want** to save my current device configuration as a named preset,
**so that** I can quickly switch between different hardware setups (guitar rig, drum kit, full band) without manually reconfiguring IP addresses and settings each time.

---

## Background / Context

### Current State (Story 6.1 Phase 0)
- âœ… WLEDDeviceManager component manages multiple devices with **inline row UI**
- âœ… Devices auto-save to localStorage per experiment (`storageKey` prop)
- âœ… Each experiment (`/jam`, `/wled-test`, `/dj-visualizer`) maintains separate device list
- âœ… **Inline expandable settings** pattern established (no modals)
- âŒ No named presets â€” users manually configure devices each time
- âŒ Can't quickly switch between different hardware configurations
- âŒ Can't share configurations with other users or devices

### Design Philosophy Alignment
This story follows the **anti-modal design philosophy** established in UX_STANDARDS.md:
- âŒ No modals, overlays, or blocking dialogs
- âœ… Inline forms that expand/collapse in place
- âœ… Toast notifications for confirmations and feedback
- âœ… Non-blocking undo/redo patterns
- âœ… Keyboard-accessible inline interactions

### User Pain Points
1. **Repetitive Setup:** Users configure same devices repeatedly across experiments
2. **Performance Anxiety:** Manual setup before live performances is error-prone
3. **Multi-Config Scenarios:** Users with multiple rigs (guitar + drums, studio vs live) can't switch quickly
4. **No Backup:** Clearing browser data loses all configurations

---

## Acceptance Criteria

### AC 1: Inline Preset Save Form âœ…

**Given** I have configured 2+ WLED devices in WLEDDeviceManager
**When** I click "Save as Preset" button
**Then** an inline form expands below the button
**And** I can enter preset name and optional description
**And** clicking "Save" saves to localStorage and collapses the form
**And** I see a success toast notification

**Details:**
- Form expands in place (no modal/overlay)
- Preset name input auto-focused when form expands
- Inline validation (duplicate name check, empty name check)
- Save button disabled when validation fails
- Form collapses after successful save
- Success toast: "âœ“ Guitar Setup saved (3 devices)"

**UI Pattern (Inline Expandable Form):**
```
[COLLAPSED STATE]
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Presets: [Guitar Setup â–¾] [ğŸ’¾ Save as Preset]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[EXPANDED STATE - Inline Form]
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Presets: [Guitar Setup â–¾] [ğŸ’¾ Save as Preset]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Save Current Configuration as Preset              â”‚
â”‚                                                    â”‚
â”‚ Preset Name *                                      â”‚
â”‚ [Guitar Setup 2_____________________]              â”‚
â”‚ â†‘ Auto-focused                                     â”‚
â”‚                                                    â”‚
â”‚ Description (optional)                             â”‚
â”‚ [3 WLED strips for guitar...________]              â”‚
â”‚ 48/200                                             â”‚
â”‚                                                    â”‚
â”‚ [Cancel] [Save Preset]                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Edge Cases:**
- Empty device list: Disable "Save as Preset" button, tooltip: "Add devices first"
- Duplicate name: Show inline error below input: "âš ï¸ Preset 'Guitar Setup' already exists"
- localStorage quota exceeded: Show toast error with export suggestion

---

### AC 2: Inline Preset Dropdown (No Overlay) âœ…

**Given** I have 1+ saved presets
**When** I click the preset dropdown
**Then** a dropdown menu expands inline below the button
**And** I can select a preset to load
**And** loading a preset updates devices immediately

**Details:**
- Custom dropdown (not native `<select>`) for consistent styling
- Dropdown positioned relative to button (no z-index overlay drama)
- Presets sorted by last modified (newest first)
- Each preset shows: name, device count, last modified time
- Click outside dropdown to close (no backdrop overlay)

**UI Pattern (Inline Dropdown):**
```
[DROPDOWN OPEN - Positioned relative to trigger]
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Presets: [Select preset... â–¾]                      â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚          â”‚ Guitar Setup â˜…                       â”‚  â”‚ â† Current
â”‚          â”‚ 3 devices â€¢ 2 hours ago              â”‚  â”‚
â”‚          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚          â”‚ Drum Kit Config                      â”‚  â”‚
â”‚          â”‚ 5 devices â€¢ 3 days ago               â”‚  â”‚
â”‚          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚          â”‚ Full Rig                             â”‚  â”‚
â”‚          â”‚ 8 devices â€¢ Jan 9                    â”‚  â”‚
â”‚          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚          â”‚ + Save New Preset                    â”‚  â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### AC 3: Unsaved Changes with Toast Confirmation âœ…

**Given** I have a preset loaded
**When** I modify any device setting
**Then** the preset name shows "(modified)" indicator
**And** clicking "Update [Preset Name]" button saves changes inline
**And** loading a different preset shows brief undo toast

**Details:**
- Unsaved changes indicator: yellow text "(modified)" next to preset name
- "Update [Preset Name]" button appears when modified (replaces "Save as Preset")
- Loading different preset â†’ Non-blocking action with undo toast
- Toast: "Loaded Drum Kit Config â€¢ [Undo]" (5 second auto-dismiss)
- Clicking [Undo] restores previous devices

**UI Pattern (Non-Blocking Undo):**
```
[USER CLICKS DIFFERENT PRESET]
â†’ Devices change immediately (no confirmation dialog)
â†’ Toast appears:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ âœ“ Loaded Drum Kit Config    [Undo]  [âœ•] â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  Auto-dismiss: 5 seconds
  Click [Undo]: Restore previous preset
```

**Replaces:** Blocking "You have unsaved changes" modal (old pattern)
**New Pattern:** Immediate action + undo option (Gmail-style)

---

### AC 4: Inline Preset Management âœ…

**Given** I have saved presets
**When** I click "Manage Presets" button
**Then** an inline management section expands below
**And** I can rename, duplicate, or delete presets inline

**Details:**
- Management section expands in place (no modal)
- Each preset row has inline actions: [Rename] [Duplicate] [Delete]
- Rename: Input field appears inline, click outside to cancel
- Duplicate: Creates copy immediately, toast confirms
- Delete: Immediate delete with undo toast (no blocking confirmation)

**UI Pattern (Inline Management):**
```
[MANAGE PRESETS EXPANDED]
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Manage Presets                         [âœ• Close]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ ğŸ¸ Guitar Setup â­             3 devices       â”‚â”‚
â”‚ â”‚ Modified 2 hours ago                           â”‚â”‚
â”‚ â”‚ [Set Default] [Rename] [Duplicate] [Delete]    â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ ğŸ¥ Drum Kit Config             5 devices       â”‚â”‚
â”‚ â”‚ Modified 3 days ago                            â”‚â”‚
â”‚ â”‚ [Set Default] [Rename] [Duplicate] [Delete]    â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[RENAME MODE - Inline Input]
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¸ [Guitar Setup Pro___] âœ“ âœ•    3 devices        â”‚
â”‚     â†‘ Inline editable input                        â”‚
â”‚     âœ“ = Save, âœ• = Cancel                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### AC 5: Toast Notifications (No Blocking Dialogs) âœ…

**All user feedback uses toast notifications, not blocking dialogs:**

**Success Toasts:**
- âœ“ Guitar Setup saved (3 devices)
- âœ“ Loaded Drum Kit Config â€¢ [Undo]
- âœ“ Preset renamed to "Guitar Setup Pro"
- âœ“ Preset duplicated as "Drum Kit Config (Copy)"

**Error Toasts:**
- âš ï¸ Storage limit reached. [Export Presets]
- âš ï¸ Preset name already exists
- âš ï¸ Some presets could not be loaded

**Undo Toasts:**
- âœ“ Preset deleted â€¢ [Undo] (5 sec auto-dismiss)
- âœ“ Loaded Drum Kit Config â€¢ [Undo]

**Toast Positioning:**
- Top-right corner (desktop): Fixed position, stacks vertically
- Top center (mobile): Full-width, safe-area-inset aware

---

### AC 6: Preset Persistence Across Sessions âœ…

(No changes from original - localStorage persistence works the same)

---

### AC 7: Performance Requirements âœ…

- **Save Preset:** <50ms to localStorage (inline form collapse)
- **Load Preset:** <200ms to parse and apply (no modal animation overhead)
- **Dropdown Render:** <100ms for up to 50 presets
- **Toast Animations:** <150ms fade in/out (Tailwind transitions)
- **No UI Blocking:** All operations non-blocking (undo pattern)

---

## UI Components (Inline Patterns)

### Component: PresetManager (Integrated into WLEDDeviceManager)

**Location:** Top of WLEDDeviceManager, before device list

```tsx
// src/components/WLED/WLEDDeviceManager.tsx additions

const [showSaveForm, setShowSaveForm] = useState(false);
const [showManagePanel, setShowManagePanel] = useState(false);
const [presetName, setPresetName] = useState('');
const [presetDescription, setPresetDescription] = useState('');
const [currentPresetId, setCurrentPresetId] = useState<string | null>(null);
const [hasUnsavedChanges, setHasUnsavedChanges] = useState(false);

return (
  <div className="space-y-4">
    {/* Preset Controls */}
    <div className="p-4 bg-gray-800 rounded-lg space-y-3">
      {/* Preset Selector Row */}
      <div className="flex items-center gap-2">
        <PresetDropdown
          presets={presets}
          currentPresetId={currentPresetId}
          hasUnsavedChanges={hasUnsavedChanges}
          onLoad={handleLoadPreset}
        />

        {hasUnsavedChanges && currentPresetId ? (
          <button onClick={handleUpdatePreset} className="btn-primary">
            Update {getCurrentPresetName()}
          </button>
        ) : (
          <button
            onClick={() => setShowSaveForm(!showSaveForm)}
            className="btn-secondary"
            disabled={devices.length === 0}
          >
            ğŸ’¾ Save as Preset
          </button>
        )}

        <button
          onClick={() => setShowManagePanel(!showManagePanel)}
          className="btn-secondary"
        >
          Manage Presets
        </button>
      </div>

      {/* Inline Save Form (Expandable) */}
      {showSaveForm && (
        <div className="border-t border-gray-700 pt-3 space-y-3">
          <h4 className="text-sm font-medium text-gray-300">
            Save Current Configuration as Preset
          </h4>

          <div>
            <label className="block text-sm text-gray-400 mb-1">
              Preset Name *
            </label>
            <input
              type="text"
              value={presetName}
              onChange={(e) => setPresetName(e.target.value)}
              placeholder="Guitar Setup"
              maxLength={50}
              autoFocus
              className="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-primary-500"
            />
            {getNameError() && (
              <p className="text-sm text-red-500 mt-1">
                âš ï¸ {getNameError()}
              </p>
            )}
          </div>

          <div>
            <label className="block text-sm text-gray-400 mb-1">
              Description (optional)
            </label>
            <textarea
              value={presetDescription}
              onChange={(e) => setPresetDescription(e.target.value)}
              placeholder="3 WLED strips for guitar neck lighting"
              maxLength={200}
              rows={2}
              className="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-primary-500 resize-none"
            />
            <span className="text-xs text-gray-500">
              {presetDescription.length}/200
            </span>
          </div>

          <div className="flex gap-2">
            <button
              onClick={() => {
                setShowSaveForm(false);
                setPresetName('');
                setPresetDescription('');
              }}
              className="btn-secondary flex-1"
            >
              Cancel
            </button>
            <button
              onClick={handleSavePreset}
              disabled={!presetName.trim() || !!getNameError()}
              className="btn-primary flex-1 disabled:opacity-50 disabled:cursor-not-allowed"
            >
              Save Preset
            </button>
          </div>
        </div>
      )}

      {/* Inline Manage Panel (Expandable) */}
      {showManagePanel && (
        <div className="border-t border-gray-700 pt-3 space-y-2">
          <div className="flex items-center justify-between mb-2">
            <h4 className="text-sm font-medium text-gray-300">
              Manage Presets
            </h4>
            <button
              onClick={() => setShowManagePanel(false)}
              className="text-gray-400 hover:text-white"
            >
              âœ•
            </button>
          </div>

          <div className="space-y-2 max-h-64 overflow-y-auto">
            {presets.map((preset) => (
              <PresetManagementRow
                key={preset.id}
                preset={preset}
                isDefault={preset.id === currentPresetId}
                onRename={(newName) => handleRenamePreset(preset.id, newName)}
                onDuplicate={() => handleDuplicatePreset(preset.id)}
                onDelete={() => handleDeletePreset(preset.id)}
                onSetDefault={() => setCurrentPresetId(preset.id)}
              />
            ))}
          </div>
        </div>
      )}
    </div>

    {/* Existing Device List */}
    {/* ... WLEDDeviceManager device rows ... */}
  </div>
);
```

### Component: PresetDropdown (Inline, No Overlay)

```tsx
// src/components/WLED/PresetDropdown.tsx

export function PresetDropdown({ presets, currentPresetId, hasUnsavedChanges, onLoad }) {
  const [isOpen, setIsOpen] = useState(false);
  const dropdownRef = useRef<HTMLDivElement>(null);
  const currentPreset = presets.find((p) => p.id === currentPresetId);

  // Close on click outside
  useEffect(() => {
    function handleClickOutside(e: MouseEvent) {
      if (dropdownRef.current && !dropdownRef.current.contains(e.target as Node)) {
        setIsOpen(false);
      }
    }
    document.addEventListener('mousedown', handleClickOutside);
    return () => document.removeEventListener('mousedown', handleClickOutside);
  }, []);

  return (
    <div ref={dropdownRef} className="relative flex-1">
      <button
        onClick={() => setIsOpen(!isOpen)}
        className="w-full px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-colors duration-200 flex items-center justify-between min-h-[44px]"
      >
        <span>
          {currentPreset ? (
            <>
              {currentPreset.name}
              {hasUnsavedChanges && (
                <span className="text-yellow-500 ml-2">(modified)</span>
              )}
            </>
          ) : (
            'Select preset...'
          )}
        </span>
        <ChevronDown
          className={`w-4 h-4 transition-transform duration-200 ${
            isOpen ? 'rotate-180' : ''
          }`}
        />
      </button>

      {/* Inline Dropdown (No z-index overlay) */}
      {isOpen && (
        <div className="absolute top-full left-0 right-0 mt-2 bg-gray-800 rounded-lg shadow-lg border border-gray-700 max-h-80 overflow-y-auto">
          <div className="p-2 space-y-1">
            {presets.length === 0 ? (
              <div className="px-3 py-8 text-center text-gray-400">
                <p className="text-sm">No presets yet</p>
                <p className="text-xs mt-1">Save your first preset to get started</p>
              </div>
            ) : (
              presets.map((preset) => (
                <button
                  key={preset.id}
                  onClick={() => {
                    onLoad(preset.id);
                    setIsOpen(false);
                  }}
                  className={`w-full px-3 py-2 text-left rounded-lg transition-colors duration-200 min-h-[44px] flex flex-col justify-center ${
                    preset.id === currentPresetId
                      ? 'bg-primary-600 hover:bg-primary-700'
                      : 'hover:bg-gray-700'
                  }`}
                >
                  <div className="flex items-center gap-2">
                    <span className="text-white font-medium">{preset.name}</span>
                    {preset.id === currentPresetId && <span className="text-yellow-400">â˜…</span>}
                  </div>
                  <span className="text-gray-400 text-sm">
                    {preset.devices.length} device{preset.devices.length !== 1 ? 's' : ''} â€¢{' '}
                    {formatRelativeTime(preset.updatedAt)}
                  </span>
                </button>
              ))
            )}

            <button
              onClick={() => {
                setIsOpen(false);
                // Trigger save form (parent handles this)
              }}
              className="w-full px-3 py-2 text-left text-primary-400 hover:bg-gray-700 rounded-lg transition-colors duration-200 min-h-[44px] flex items-center gap-2"
            >
              <Plus className="w-4 h-4" />
              <span>Save New Preset</span>
            </button>
          </div>
        </div>
      )}
    </div>
  );
}
```

### Component: Toast Notification System

```tsx
// src/components/common/Toast.tsx

export function useToast() {
  const [toasts, setToasts] = useState<Toast[]>([]);

  const showToast = (message: string, options?: ToastOptions) => {
    const id = crypto.randomUUID();
    const toast: Toast = {
      id,
      message,
      type: options?.type || 'success',
      duration: options?.duration || 5000,
      action: options?.action, // { label: 'Undo', onClick: () => {} }
    };

    setToasts((prev) => [...prev, toast]);

    if (toast.duration > 0) {
      setTimeout(() => {
        setToasts((prev) => prev.filter((t) => t.id !== id));
      }, toast.duration);
    }
  };

  return { toasts, showToast, hideToast };
}

// Usage:
const { showToast } = useToast();

// Success with undo
showToast('Loaded Drum Kit Config', {
  type: 'success',
  action: {
    label: 'Undo',
    onClick: () => restorePreviousPreset(),
  },
});

// Error with action
showToast('Storage limit reached', {
  type: 'error',
  duration: 0, // Persist until dismissed
  action: {
    label: 'Export Presets',
    onClick: () => handleExportAll(),
  },
});
```

**Toast Positioning & Styling:**
```tsx
// Desktop: Top-right, stacked
<div className="fixed top-4 right-4 space-y-2 z-50 max-w-md">
  {toasts.map((toast) => (
    <div
      key={toast.id}
      className={`
        px-4 py-3 rounded-lg shadow-lg border
        flex items-center justify-between gap-3
        animate-slide-in-right
        ${toast.type === 'success' ? 'bg-green-600 border-green-500 text-white' : ''}
        ${toast.type === 'error' ? 'bg-red-600 border-red-500 text-white' : ''}
      `}
    >
      <span className="text-sm">{toast.message}</span>
      <div className="flex items-center gap-2">
        {toast.action && (
          <button
            onClick={toast.action.onClick}
            className="text-sm underline hover:no-underline"
          >
            {toast.action.label}
          </button>
        )}
        <button onClick={() => hideToast(toast.id)} className="hover:opacity-70">
          âœ•
        </button>
      </div>
    </div>
  ))}
</div>

// Mobile: Top center, full-width with safe-area
<div className="fixed top-0 left-0 right-0 p-4 space-y-2 z-50" style={{ paddingTop: 'max(16px, env(safe-area-inset-top))' }}>
  {/* Same toast content, but full-width */}
</div>
```

---

## Wireframes (Inline UI - No Modals)

### State 1: Empty State
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WLED Devices                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Presets                                          â”‚ â”‚
â”‚ â”‚                                                  â”‚ â”‚
â”‚ â”‚ [No presets yet â–¾]  [ğŸ’¾ Save as Preset] (disabled)â”‚
â”‚ â”‚                                                  â”‚ â”‚
â”‚ â”‚ ğŸ’¡ Save your device setup to quickly switch     â”‚ â”‚
â”‚ â”‚    between configurations                        â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                      â”‚
â”‚ [+ Add WLED Device]                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### State 2: Save Form Expanded (Inline)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WLED Devices                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Presets                                          â”‚ â”‚
â”‚ â”‚ [Select preset... â–¾]  [ğŸ’¾ Save as Preset]       â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ Save Current Configuration as Preset            â”‚ â”‚
â”‚ â”‚                                                  â”‚ â”‚
â”‚ â”‚ Preset Name *                                    â”‚ â”‚
â”‚ â”‚ [Guitar Setup_________________________]          â”‚ â”‚
â”‚ â”‚                                                  â”‚ â”‚
â”‚ â”‚ Description (optional)                           â”‚ â”‚
â”‚ â”‚ [3 WLED strips for guitar neck...____]           â”‚ â”‚
â”‚ â”‚ 48/200                                           â”‚ â”‚
â”‚ â”‚                                                  â”‚ â”‚
â”‚ â”‚ [Cancel]  [Save Preset]                          â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                      â”‚
â”‚ [Device rows below...]                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### State 3: Dropdown Open (Inline, Not Overlay)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Presets                                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ [Select preset... â–¾]                          â”‚   â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚ â”‚ â”‚ Guitar Setup â˜…         3 devices         â”‚  â”‚   â”‚
â”‚ â”‚ â”‚ Modified 2 hours ago                     â”‚  â”‚   â”‚
â”‚ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚   â”‚
â”‚ â”‚ â”‚ Drum Kit Config        5 devices         â”‚  â”‚   â”‚
â”‚ â”‚ â”‚ Modified 3 days ago                      â”‚  â”‚   â”‚
â”‚ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚   â”‚
â”‚ â”‚ â”‚ + Save New Preset                        â”‚  â”‚   â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### State 4: Manage Panel Expanded (Inline)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Presets: [Guitar Setup (modified) â–¾] [Update Guitar Setup]â”‚
â”‚ [Manage Presets]                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Manage Presets                              [âœ• Close]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ¸ Guitar Setup â­              3 devices        â”‚ â”‚
â”‚ â”‚ Modified 2 hours ago                             â”‚ â”‚
â”‚ â”‚ [Rename] [Duplicate] [Delete]                    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ¥ Drum Kit Config              5 devices        â”‚ â”‚
â”‚ â”‚ Modified 3 days ago                              â”‚ â”‚
â”‚ â”‚ [Set Default] [Rename] [Duplicate] [Delete]      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### State 5: Toast Notification (Non-Blocking)
```
[Top-right corner - Desktop]
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ“ Guitar Setup saved (3 devices)  [âœ•] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Auto-dismiss: 3 seconds

[Top-right corner - Undo Toast]
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ“ Loaded Drum Kit Config  [Undo]  [âœ•]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Auto-dismiss: 5 seconds
```

---

## Technical Specifications

### Data Models
(No changes from original - same WLEDPreset interface)

### localStorage Service
(No changes from original - same presetStorage.ts implementation)

### New Components

#### 1. PresetManager (integrated into WLEDDeviceManager)
- **Location:** Top section of WLEDDeviceManager
- **State:** `showSaveForm`, `showManagePanel`, `presetName`, `presetDescription`, `currentPresetId`, `hasUnsavedChanges`
- **Pattern:** Expandable inline sections (no modals)
- **LOC:** ~150 lines (integrated)

#### 2. PresetDropdown Component
- **File:** `src/components/WLED/PresetDropdown.tsx`
- **Pattern:** Inline dropdown with click-outside-to-close
- **No z-index overlay:** Positioned relative to trigger
- **LOC:** ~80 lines

#### 3. PresetManagementRow Component
- **File:** `src/components/WLED/PresetManagementRow.tsx`
- **Features:** Inline rename, delete with undo, duplicate
- **Pattern:** Expandable row with actions
- **LOC:** ~60 lines

#### 4. Toast System
- **File:** `src/components/common/Toast.tsx` + `src/hooks/useToast.ts`
- **Pattern:** Stacked toasts, auto-dismiss, undo actions
- **Position:** Top-right (desktop), top-center (mobile)
- **LOC:** ~120 lines

### Removed Components (No Longer Needed)
- âŒ SavePresetModal.tsx (replaced with inline form)
- âŒ ConfirmDialog.tsx (replaced with toast undo)
- âŒ Any modal/overlay components

---

## File Locations

### New Files
- `src/services/presetStorage.ts` (~200 lines) - localStorage CRUD
- `src/components/WLED/PresetDropdown.tsx` (~80 lines) - Inline dropdown
- `src/components/WLED/PresetManagementRow.tsx` (~60 lines) - Management row
- `src/components/common/Toast.tsx` (~80 lines) - Toast UI
- `src/hooks/useToast.ts` (~40 lines) - Toast state management

### Modified Files
- `src/components/WLED/WLEDDeviceManager.tsx` - Add preset section (~150 lines added)
- `src/components/WLED/types.ts` - Add WLEDPreset interface

### Total LOC Estimate
- New code: ~610 lines
- Modified code: ~150 lines
- **Total: ~760 lines**
- **Removed: ~300 lines** (modals/overlays not needed)

---

## Design System Compliance

### âœ… Follows UX_STANDARDS.md Anti-Modal Philosophy

**From UX_STANDARDS.md:**
- âœ… Uses `.btn-primary` and `.btn-secondary` classes
- âœ… Uses Tailwind color tokens (primary-600, yellow-500, etc.)
- âœ… Border radius: `rounded-lg` for controls, `rounded-xl` for containers
- âœ… Touch targets: `min-h-[44px]` consistently applied
- âœ… No modals, overlays, or blocking dialogs
- âœ… Inline expandable forms
- âœ… Toast notifications for feedback
- âœ… Undo pattern for destructive actions
- âœ… Lucide React icons exclusively

### âœ… Follows Story 5.1 Responsive Pattern

**Single instance rendering:**
```tsx
// PresetManager always renders, sections expand/collapse
<div className="preset-manager">
  <PresetDropdown />
  {showSaveForm && <InlineSaveForm />}
  {showManagePanel && <InlineManagePanel />}
</div>
```

**No conditional component mounting** - sections expand/collapse with CSS

---

## Success Metrics

- [ ] User can save preset in <3 clicks (no modal workflow overhead)
- [ ] Loading preset with undo option feels instant (<200ms)
- [ ] 0 data loss incidents (presets persist correctly)
- [ ] <1% error rate on save/load operations
- [ ] Inline forms expand/collapse smoothly (<150ms transitions)
- [ ] Toast notifications feel helpful, not annoying (based on user feedback)

---

## Migration Path to Story 8.3 (Cloud Storage)

(No changes from original - same localStorage â†’ Supabase migration strategy)

---

## Dependencies

**Hard Dependencies:**
- âœ… Story 6.1 Phase 0: WLEDDeviceManager component exists with inline UI pattern
- âœ… UX_STANDARDS.md: Anti-modal design philosophy documented

**Soft Dependencies:**
- Story 5.1: Responsive architecture patterns
- CLAUDE.md: UX design standards

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-01-09 | 1.0 | Initial story creation for local preset save/load | PM Agent (John) |
| 2025-01-09 | 2.0 | Complete rewrite to eliminate modals/overlays, use inline UI patterns, toast notifications, and undo actions per UX_STANDARDS.md anti-modal philosophy | UX Expert (Sally) |

---

## Next Steps

1. **Review & Approve:** Confirm inline UI approach (no modals)
2. **Implementation:** Build components per technical specs
3. **Testing:** Manual testing with real WLED hardware
4. **Iteration:** Refine UX based on tester feedback (toast timing, undo duration, etc.)
5. **Handoff to Story 8.2:** Preset management UI enhancements

**Estimated Implementation Time:** 1-2 days for experienced React/TypeScript developer

**Key Difference from v1.0:** Removes ~300 lines of modal/overlay code, replaces with simpler inline patterns. Faster to implement, better UX, more consistent with app design philosophy.
