# Story: Static Step Sequencer LED Visualization Mode

## Story ID: EPIC-2-LED-003
**Status:** Completed
**Epic:** Epic 2 - 3D Boomwhacker Music Learning Application
**Priority:** High

## Story
As a music educator using WLED strips for step sequencer visualization, I want a static step sequencer LED mode as the default visualization that clearly shows notes positioned at fixed steps on the strip, so that students can easily see the timing structure and note placement without the distraction of moving patterns.

## Acceptance Criteria
- [ ] Static step sequencer mode is the default LED visualization
- [ ] LED strip divided into 8 main step sections based on total LED count
- [ ] Support for 16th note resolution (16 sections available)
- [ ] Single white pixel timeline/strike bar moves from end to beginning
- [ ] Notes appear as colored LEDs at their step positions
- [ ] Multiple notes at same position cycle colors to indicate overlap
- [ ] Current moving/gamified pattern preserved as secondary toggleable option
- [ ] Perfect synchronization with 3D visualization timing
- [ ] Clear visual distinction between step boundaries
- [ ] Timeline bar provides clear beat reference

## Dev Notes
- Current SingleLaneVisualizer.ts uses moving "Guitar Hero" style visualization
- Need to preserve existing moving pattern as optional mode
- Static mode should be more educational and less distracting
- Timeline bar replaces moving strike bar concept
- Color cycling for overlapping notes enhances multi-lane strip support

## Tasks
- [ ] Add visualization mode toggle to LEDVisualizationSettings
  - [ ] Add `visualizationMode: 'static' | 'moving'` to settings interface
  - [ ] Set 'static' as default mode
  - [ ] Preserve current logic under 'moving' mode
- [ ] Implement static step sequencer algorithm
  - [ ] Calculate step divisions: `stepSize = ledCount / 8` for 8 main steps
  - [ ] Map 16-step pattern to 16 LED positions for 16th note resolution
  - [ ] Position notes at fixed LED indices based on step timing
  - [ ] Calculate LED positions: `ledIndex = Math.round(stepIndex * ledCount / 16)`
- [ ] Create moving timeline/strike bar
  - [ ] Single white pixel that moves from end (LED count-1) to beginning (0)
  - [ ] Movement synchronized with beat progress from 3D visualization
  - [ ] Timeline position: `timelineIndex = Math.round((1 - beatProgress) * ledCount)`
  - [ ] Clear white color (255, 255, 255) for maximum visibility
- [ ] Handle multiple notes at same position
  - [ ] Detect when multiple lane patterns have notes at same step
  - [ ] Implement color cycling: rotate through active colors every 200ms
  - [ ] Blend colors when multiple active simultaneously
  - [ ] Ensure timeline bar always overrides note colors
- [ ] Integrate with existing SingleLaneVisualizer.ts
  - [ ] Add mode parameter to generateLEDArray method
  - [ ] Preserve all existing HTTP/UDP/WebSocket communication
  - [ ] Maintain rate limiting and error handling
  - [ ] Keep debug logging for both modes
- [ ] Synchronization with 3D visualization
  - [ ] Use same beatProgress calculation as 3D sequencer
  - [ ] Ensure step timing matches IsometricSequencer beat timing
  - [ ] Verify currentStep and pattern synchronization
  - [ ] Test with both smooth and eased animation modes

## Testing
- Visual verification of static step positioning
- Timeline synchronization accuracy testing
- Multiple note color cycling verification
- Mode toggle functionality testing
- Performance testing with rapid updates

## File List
- `src/utils/SingleLaneVisualizer.ts` (primary changes)
- `src/types/led.ts` (settings interface update)

## Change Log
- Initial story creation for static LED step sequencer mode
- Focus on educational clarity and timing visualization
- Preserves existing moving mode as secondary option

## Dev Agent Record
**Agent Model Used:** Claude
**Debug Log References:**
**Completion Notes:**
- Story addresses need for clearer educational LED visualization
- Maintains backward compatibility with existing moving pattern
- Emphasizes synchronization with 3D visualization for consistent learning experience
- Supports multi-channel LED strips with color cycling for overlapping notes