# Story 9.3: Guitar Fretboard Visualizer with LED Matrix Output

**Epic:** Multi-Instrument MIDI Visualization (Epic 9)
**Status:** üìù **PLANNING** - Blocked by Story 9.1, 9.2
**Priority:** Medium
**Complexity:** Medium
**Prerequisites:**
- ‚úÖ Story 9.1 (Web MIDI Input Engine) - Must be complete
- ‚úÖ Story 9.2 (Piano Roll Visualizer) - Learn from implementation

---

## Story

**As a** guitarist with a MIDI guitar pickup or controller,
**I want** to see an interactive 6-string √ó 25-fret guitar fretboard that visualizes chords and notes I play,
**so that** I can visualize music theory concepts and control a physical LED matrix mounted behind my guitar neck.

---

## Background / Context

### Python Reference Implementation
`research/wled-guitar-fretboard-pygame.0.4.py` demonstrates:
- 6 strings √ó 25 frets interactive visualization
- Standard tuning: E A D G B E (MIDI offsets: 4, 9, 2, 7, 11, 4)
- Chord progressions (Jazz ii-V-I, Blues in A, Pop I-V-vi-IV)
- Auto-advance chords every 5 seconds
- Chromatic and Harmonic color modes
- Click-to-play individual frets
- WLED UDP output to 6√ó25 LED matrix (150 LEDs, serpentine wiring)

### Current State
- ‚úÖ **MIDI input working** (Story 9.1) - midiInputManager ready
- ‚úÖ **Color mappings ready** - colorMapping.ts has chromatic/harmonic modes
- ‚úÖ **WLED integration ready** - WLEDDeviceManager supports matrices
- ‚úÖ **Audio playback ready** - Tone.js available
- ‚úÖ **Piano implementation complete** (Story 9.2) - Canvas patterns established
- ‚ùå **No guitar fretboard UI** - Need canvas-based guitar component
- ‚ùå **No chord progression data** - Need TypeScript chord definitions

---

## Acceptance Criteria

### AC 1: 6√ó25 Fretboard Canvas ‚úÖ
- [ ] Render 6 strings √ó 25 frets (150 positions total)
- [ ] String labels on left: E A D G B E (low to high)
- [ ] Fret numbers at bottom: 0-24
- [ ] Responsive canvas sizing (scales to parent container)
- [ ] Each fret position shows colored circle
- [ ] Active notes show full brightness, inactive show 10%
- [ ] 60fps canvas rendering (desktop), 30fps acceptable (mobile)

### AC 2: Standard Tuning Matrix ‚úÖ
- [ ] Standard tuning: E A D G B E
- [ ] MIDI note calculation: `note = (tuning[string] + fret) % 12`
- [ ] Fretboard matrix pre-calculated (6√ó25 array)
- [ ] Each position shows correct note color based on pitch class
- [ ] Octave-agnostic coloring (C is red regardless of octave)

### AC 3: Chord Progressions ‚úÖ
- [ ] Three built-in chord progressions:
  - Jazz ii-V-I in C: Dm7 ‚Üí G7 ‚Üí Cmaj7
  - Blues in A: A7 ‚Üí D7 ‚Üí E7
  - Pop I-V-vi-IV in G: G ‚Üí D ‚Üí Em ‚Üí C
- [ ] Auto-advance to next chord every 5 seconds
- [ ] Chord name displayed prominently
- [ ] Progression name displayed
- [ ] Keyboard shortcut 'N' to manually cycle progressions
- [ ] Current chord notes highlighted on fretboard

### AC 4: MIDI Input Highlighting ‚úÖ
- [ ] Connect to MIDI guitar pickup via midiInputManager
- [ ] Highlight fret positions when MIDI notes received
- [ ] Support polyphony (multiple strings/notes)
- [ ] Visual feedback latency <20ms (MIDI ‚Üí highlight)
- [ ] Works alongside chord progressions (both can be active)

### AC 5: Color Modes (Chromatic & Harmonic) ‚úÖ
- [ ] Chromatic mode: 12-color spectrum (C=red, C#=orange, etc.)
- [ ] Harmonic mode: Circle of fifths color mapping
- [ ] Toggle button to switch color modes (keyboard shortcut 'C')
- [ ] Colors match Python reference exactly
- [ ] Color mode applies to both canvas and WLED output
- [ ] Color mode persists across sessions (localStorage)

### AC 6: Click-to-Play Frets ‚úÖ
- [ ] Click any fret position ‚Üí play note via Tone.js
- [ ] Touch support for mobile (44px minimum targets)
- [ ] Visual feedback: fret highlights for 500ms
- [ ] Audio feedback: guitar-like sound (PolySynth with triangle wave)
- [ ] Works when no MIDI device connected (testing mode)

### AC 7: WLED LED Matrix Output ‚úÖ
- [ ] Integrate WLEDDeviceManager for matrix configuration
- [ ] Support 6√ó25 LED matrix (150 LEDs)
- [ ] Serpentine wiring pattern:
  - Even rows (0, 2, 4): left to right
  - Odd rows (1, 3, 5): right to left
- [ ] LED mapping function: `fretboardToLEDIndex(string, fret)`
- [ ] Real-time LED updates when chords change
- [ ] Real-time LED updates when MIDI notes received
- [ ] WLED device settings in collapsible panel

### AC 8: MIDIDeviceSelector Integration ‚úÖ
- [ ] Embed MIDIDeviceSelector component (Story 9.1)
- [ ] Show in collapsible settings panel
- [ ] Device selection updates fretboard highlighting
- [ ] Keyboard fallback mode works with guitar
- [ ] Last MIDI message displayed for debugging

### AC 9: Responsive Mobile UX ‚úÖ
- [ ] Desktop: Fretboard canvas + settings sidebar
- [ ] Mobile: Full-width fretboard with collapsible settings
- [ ] Landscape mode STRONGLY recommended (show persistent hint)
- [ ] Touch gestures: Tap to play frets
- [ ] 44px minimum touch targets on fret circles
- [ ] Follows Story 5.1 responsive patterns

### AC 10: Welcome Screen Integration ‚úÖ
- [ ] Add "Guitar Fretboard" card to Welcome screen Experiments
- [ ] Route: `/guitar-fretboard`
- [ ] Icon: Guitar icon from Lucide React
- [ ] Badge: "Beta" (amber colors)
- [ ] Description mentions chords and LED matrix
- [ ] Placement: After Piano Roll

---

## Technical Specifications

### Guitar Fretboard Constants

```typescript
// src/components/GuitarFretboard/constants.ts

export const GUITAR_CONSTANTS = {
  STRINGS: 6,
  FRETS: 25,
  TOTAL_POSITIONS: 150  // 6 √ó 25
};

// Standard tuning (MIDI note offsets from C)
export const STANDARD_TUNING = [
  4,  // String 6 (Low E)
  9,  // String 5 (A)
  2,  // String 4 (D)
  7,  // String 3 (G)
  11, // String 2 (B)
  4   // String 1 (High E)
];

export const STRING_NAMES = ['E', 'A', 'D', 'G', 'B', 'E'];

export const NOTE_NAMES = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];

/**
 * Create fretboard matrix (6 strings √ó 25 frets)
 * Each cell contains the note class (0-11) for that position
 */
export function createFretboardMatrix(): number[][] {
  return STANDARD_TUNING.map(openNote =>
    Array.from({ length: GUITAR_CONSTANTS.FRETS }, (_, fret) => (openNote + fret) % 12)
  );
}

/**
 * Convert string/fret position to LED index (serpentine wiring)
 */
export function fretboardToLEDIndex(string: number, fret: number): number {
  // string: 0-5 (0 = low E)
  // fret: 0-24
  if (string % 2 === 0) {
    // Even rows: left to right
    return string * 25 + fret;
  } else {
    // Odd rows: right to left (serpentine)
    return string * 25 + (24 - fret);
  }
}

/**
 * Get MIDI note number for fret position
 */
export function getMIDINoteFromFret(string: number, fret: number): number {
  const baseNote = STANDARD_TUNING[string];
  const octave = 3 + Math.floor((baseNote + fret) / 12);
  const noteClass = (baseNote + fret) % 12;
  return octave * 12 + noteClass + 12;  // Adjust for MIDI numbering
}
```

---

### Chord Progressions Data

```typescript
// src/components/GuitarFretboard/chordProgressions.ts

export interface ChordNote {
  string: number;  // 1-6 (1 = high E, 6 = low E)
  fret: number;    // 0-24
}

export interface Chord {
  name: string;
  notes: ChordNote[];
}

export interface ChordProgression {
  name: string;
  chords: Chord[];
}

export const CHORD_PROGRESSIONS: ChordProgression[] = [
  {
    name: "Jazz ii-V-I in C",
    chords: [
      {
        name: "Dm7",
        notes: [
          { string: 2, fret: 1 },  // B string, fret 1
          { string: 3, fret: 1 },  // G string, fret 1
          { string: 4, fret: 2 },  // D string, fret 2
          { string: 5, fret: 3 }   // A string, fret 3
        ]
      },
      {
        name: "G7",
        notes: [
          { string: 2, fret: 1 },  // B string, fret 1
          { string: 3, fret: 0 },  // G string, open
          { string: 4, fret: 0 },  // D string, open
          { string: 5, fret: 0 },  // A string, open
          { string: 6, fret: 2 }   // Low E string, fret 2
        ]
      },
      {
        name: "Cmaj7",
        notes: [
          { string: 2, fret: 0 },  // B string, open
          { string: 3, fret: 3 },  // G string, fret 3
          { string: 4, fret: 2 },  // D string, fret 2
          { string: 5, fret: 0 },  // A string, open
          { string: 6, fret: 0 }   // Low E string, open
        ]
      }
    ]
  },
  {
    name: "Blues in A",
    chords: [
      {
        name: "A7",
        notes: [
          { string: 2, fret: 0 },
          { string: 3, fret: 2 },
          { string: 4, fret: 0 },
          { string: 5, fret: 2 },
          { string: 6, fret: 0 }
        ]
      },
      {
        name: "D7",
        notes: [
          { string: 2, fret: 2 },
          { string: 3, fret: 1 },
          { string: 4, fret: 2 },
          { string: 5, fret: 0 },
          { string: 6, fret: 2 }
        ]
      },
      {
        name: "E7",
        notes: [
          { string: 2, fret: 0 },
          { string: 3, fret: 0 },
          { string: 4, fret: 1 },
          { string: 5, fret: 0 },
          { string: 6, fret: 2 },
          { string: 1, fret: 0 }  // High E, open
        ]
      }
    ]
  },
  {
    name: "Pop I-V-vi-IV in G",
    chords: [
      {
        name: "G",
        notes: [
          { string: 2, fret: 3 },
          { string: 3, fret: 0 },
          { string: 4, fret: 0 },
          { string: 5, fret: 0 },
          { string: 6, fret: 2 },
          { string: 1, fret: 3 }
        ]
      },
      {
        name: "D",
        notes: [
          { string: 2, fret: 2 },
          { string: 3, fret: 3 },
          { string: 4, fret: 2 },
          { string: 5, fret: 0 },
          { string: 6, fret: 0 }
        ]
      },
      {
        name: "Em",
        notes: [
          { string: 2, fret: 0 },
          { string: 3, fret: 0 },
          { string: 4, fret: 0 },
          { string: 5, fret: 2 },
          { string: 6, fret: 2 }
        ]
      },
      {
        name: "C",
        notes: [
          { string: 2, fret: 0 },
          { string: 3, fret: 1 },
          { string: 4, fret: 0 },
          { string: 5, fret: 2 },
          { string: 6, fret: 3 }
        ]
      }
    ]
  }
];
```

---

### Fretboard Canvas Component

```typescript
// src/components/GuitarFretboard/FretboardCanvas.tsx

import React, { useRef, useEffect } from 'react';
import { getNoteColor, ColorMode } from '../../utils/colorMapping';
import { createFretboardMatrix, GUITAR_CONSTANTS, STRING_NAMES } from './constants';
import { ChordNote } from './chordProgressions';

interface FretboardCanvasProps {
  activeChord: ChordNote[];
  activeMIDINotes: Set<number>;  // MIDI note numbers
  colorMode: ColorMode;
  onFretClick: (string: number, fret: number) => void;
}

export const FretboardCanvas: React.FC<FretboardCanvasProps> = ({
  activeChord,
  activeMIDINotes,
  colorMode,
  onFretClick
}) => {
  const canvasRef = useRef<HTMLCanvasElement>(null);
  const fretboardMatrix = createFretboardMatrix();

  useEffect(() => {
    const canvas = canvasRef.current;
    if (!canvas) return;

    const ctx = canvas.getContext('2d');
    if (!ctx) return;

    const width = canvas.width;
    const height = canvas.height;
    const fretWidth = width / GUITAR_CONSTANTS.FRETS;
    const stringHeight = height / (GUITAR_CONSTANTS.STRINGS + 1);

    // Clear canvas
    ctx.fillStyle = '#000';
    ctx.fillRect(0, 0, width, height);

    // Draw fretboard grid
    for (let string = 0; string < GUITAR_CONSTANTS.STRINGS; string++) {
      for (let fret = 0; fret < GUITAR_CONSTANTS.FRETS; fret++) {
        const noteClass = fretboardMatrix[string][fret];
        const isChordNote = activeChord.some(
          cn => cn.string - 1 === string && cn.fret === fret
        );
        // TODO: Check if MIDI note is active (convert MIDI ‚Üí string/fret)

        const color = getNoteColor(noteClass, colorMode);
        const brightness = isChordNote ? 1.0 : 0.1;

        const x = fret * fretWidth + fretWidth / 2;
        const y = (string + 1) * stringHeight;

        // Draw fret circle
        ctx.fillStyle = `rgb(${color.r * brightness}, ${color.g * brightness}, ${color.b * brightness})`;
        ctx.beginPath();
        ctx.arc(x, y, fretWidth / 3, 0, Math.PI * 2);
        ctx.fill();

        // Draw white ring for active notes
        if (isChordNote) {
          ctx.strokeStyle = '#fff';
          ctx.lineWidth = 2;
          ctx.beginPath();
          ctx.arc(x, y, fretWidth / 4, 0, Math.PI * 2);
          ctx.stroke();
        }
      }
    }

    // Draw fret numbers
    ctx.fillStyle = '#ccc';
    ctx.font = '14px Inter';
    ctx.textAlign = 'center';
    for (let fret = 0; fret < GUITAR_CONSTANTS.FRETS; fret++) {
      ctx.fillText(String(fret), fret * fretWidth + fretWidth / 2, height - 10);
    }

    // Draw string labels
    ctx.textAlign = 'right';
    for (let string = 0; string < GUITAR_CONSTANTS.STRINGS; string++) {
      ctx.fillText(STRING_NAMES[string], 30, (string + 1) * stringHeight + 5);
    }

  }, [activeChord, activeMIDINotes, colorMode, fretboardMatrix]);

  // Handle fret clicks
  const handleCanvasClick = (e: React.MouseEvent<HTMLCanvasElement>) => {
    const canvas = canvasRef.current;
    if (!canvas) return;

    const rect = canvas.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;

    const fretWidth = canvas.width / GUITAR_CONSTANTS.FRETS;
    const stringHeight = canvas.height / (GUITAR_CONSTANTS.STRINGS + 1);

    const fret = Math.floor(x / fretWidth);
    const string = Math.floor(y / stringHeight) - 1;

    if (string >= 0 && string < GUITAR_CONSTANTS.STRINGS && fret >= 0 && fret < GUITAR_CONSTANTS.FRETS) {
      onFretClick(string, fret);
    }
  };

  return (
    <canvas
      ref={canvasRef}
      width={1200}
      height={400}
      onClick={handleCanvasClick}
      className="w-full h-auto cursor-pointer"
    />
  );
};
```

---

### Main Guitar Fretboard Component

```typescript
// src/components/GuitarFretboard/GuitarFretboard.tsx

import React, { useState, useEffect, useCallback } from 'react';
import * as Tone from 'tone';
import { Guitar, Settings } from 'lucide-react';
import { FretboardCanvas } from './FretboardCanvas';
import { MIDIDeviceSelector } from '../MIDI/MIDIDeviceSelector';
import { WLEDDeviceManager } from '../WLED/WLEDDeviceManager';
import { CollapsiblePanel } from '../Layout/CollapsiblePanel';
import { useResponsive } from '../../hooks/useResponsive';
import { midiInputManager, MIDINoteMessage } from '../../utils/midiInputManager';
import { ColorMode, getNoteColor } from '../../utils/colorMapping';
import { CHORD_PROGRESSIONS, ChordNote } from './chordProgressions';
import { createFretboardMatrix, getMIDINoteFromFret, fretboardToLEDIndex } from './constants';

export const GuitarFretboard: React.FC = () => {
  const { isMobile } = useResponsive();
  const [currentProgression, setCurrentProgression] = useState(0);
  const [currentChord, setCurrentChord] = useState(0);
  const [colorMode, setColorMode] = useState<ColorMode>('chromatic');
  const [activeMIDINotes, setActiveMIDINotes] = useState<Set<number>>(new Set());
  const [guitarSynth, setGuitarSynth] = useState<Tone.PolySynth | null>(null);
  const [lastChordChange, setLastChordChange] = useState(Date.now());

  const fretboardMatrix = createFretboardMatrix();
  const progression = CHORD_PROGRESSIONS[currentProgression];
  const chord = progression.chords[currentChord];

  // Initialize Tone.js guitar synth
  useEffect(() => {
    const synth = new Tone.PolySynth(Tone.Synth, {
      oscillator: { type: 'triangle' },  // Guitar-like waveform
      envelope: {
        attack: 0.005,
        decay: 0.3,
        sustain: 0.1,
        release: 0.5
      },
      volume: -6
    }).toDestination();

    setGuitarSynth(synth);

    return () => {
      synth.dispose();
    };
  }, []);

  // Listen for MIDI input
  useEffect(() => {
    const handleMIDI = (message: MIDINoteMessage) => {
      setActiveMIDINotes(prev => {
        const next = new Set(prev);
        if (message.type === 'noteOn') {
          next.add(message.note);

          // Play note via Tone.js
          if (guitarSynth) {
            const freq = Tone.Frequency(message.note, 'midi').toFrequency();
            guitarSynth.triggerAttack(freq, undefined, message.velocity / 127);
          }
        } else {
          next.delete(message.note);

          // Release note
          if (guitarSynth) {
            const freq = Tone.Frequency(message.note, 'midi').toFrequency();
            guitarSynth.triggerRelease(freq);
          }
        }
        return next;
      });
    };

    midiInputManager.addListener(handleMIDI);
    return () => midiInputManager.removeListener(handleMIDI);
  }, [guitarSynth]);

  // Auto-advance chords every 5 seconds
  useEffect(() => {
    const interval = setInterval(() => {
      setCurrentChord(prev => (prev + 1) % progression.chords.length);
      setLastChordChange(Date.now());
    }, 5000);

    return () => clearInterval(interval);
  }, [progression]);

  // Handle fret clicks
  const handleFretClick = useCallback((string: number, fret: number) => {
    if (!guitarSynth) return;

    const midiNote = getMIDINoteFromFret(string, fret);
    const freq = Tone.Frequency(midiNote, 'midi').toFrequency();
    guitarSynth.triggerAttackRelease(freq, '500ms');
  }, [guitarSynth]);

  // Keyboard shortcuts
  useEffect(() => {
    const handleKeyPress = (e: KeyboardEvent) => {
      if (e.key === 'c' || e.key === 'C') {
        setColorMode(prev => prev === 'chromatic' ? 'harmonic' : 'chromatic');
      } else if (e.key === 'n' || e.key === 'N') {
        setCurrentProgression(prev => (prev + 1) % CHORD_PROGRESSIONS.length);
        setCurrentChord(0);
      }
    };

    window.addEventListener('keydown', handleKeyPress);
    return () => window.removeEventListener('keydown', handleKeyPress);
  }, []);

  // Generate LED matrix data
  const generateLEDData = useCallback(() => {
    const ledData: { r: number; g: number; b: number }[] = Array(150).fill({ r: 0, g: 0, b: 0 });

    for (let string = 0; string < 6; string++) {
      for (let fret = 0; fret < 25; fret++) {
        const noteClass = fretboardMatrix[string][fret];
        const isActive = chord.notes.some(cn => cn.string - 1 === string && cn.fret === fret);
        const color = getNoteColor(noteClass, colorMode);
        const brightness = isActive ? 1.0 : 0.1;

        const ledIndex = fretboardToLEDIndex(string, fret);
        ledData[ledIndex] = {
          r: Math.round(color.r * brightness),
          g: Math.round(color.g * brightness),
          b: Math.round(color.b * brightness)
        };
      }
    }

    return ledData;
  }, [chord, colorMode, fretboardMatrix]);

  return (
    <div className="min-h-screen bg-gray-900 text-white">
      {/* Header */}
      <div className="bg-gray-800 border-b border-gray-700 p-4">
        <div className="max-w-7xl mx-auto flex items-center justify-between flex-wrap gap-4">
          <div className="flex items-center gap-3">
            <Guitar className="w-6 h-6 text-primary-500" />
            <div>
              <h1 className="text-xl font-bold">Guitar Fretboard</h1>
              <p className="text-sm text-gray-400">{progression.name} - {chord.name}</p>
            </div>
            <span className="px-2 py-1 bg-amber-500/20 text-amber-400 text-xs font-medium rounded">
              Beta
            </span>
          </div>
          <button
            onClick={() => setColorMode(prev => prev === 'chromatic' ? 'harmonic' : 'chromatic')}
            className="btn-secondary flex items-center gap-2 min-h-[44px]"
          >
            <Settings className="w-4 h-4" />
            {colorMode === 'chromatic' ? 'Chromatic' : 'Harmonic'}
          </button>
        </div>
      </div>

      {/* Main Content */}
      <div className="max-w-7xl mx-auto p-4">
        <div className={`grid gap-4 ${isMobile ? 'grid-cols-1' : 'grid-cols-3'}`}>
          {/* Fretboard Canvas */}
          <div className={isMobile ? 'col-span-1' : 'col-span-2'}>
            <div className="bg-gray-800 rounded-lg border border-gray-700 p-4">
              <FretboardCanvas
                activeChord={chord.notes}
                activeMIDINotes={activeMIDINotes}
                colorMode={colorMode}
                onFretClick={handleFretClick}
              />
              <p className="text-sm text-gray-400 mt-2 text-center">
                Click frets to play notes | Press 'C' for color mode | Press 'N' for next progression
              </p>
            </div>
          </div>

          {/* Settings Panel */}
          <div className="space-y-4">
            {/* MIDI Device Selector */}
            <CollapsiblePanel title="MIDI Input" defaultOpen={true}>
              <MIDIDeviceSelector />
            </CollapsiblePanel>

            {/* WLED LED Matrix */}
            <CollapsiblePanel title="WLED LED Matrix" defaultOpen={false}>
              <WLEDDeviceManager
                ledData={generateLEDData()}
                layout={isMobile ? 'mobile' : 'desktop'}
                storageKey="wled-guitar-fretboard"
                deviceType="matrix"
              />
            </CollapsiblePanel>

            {/* Info */}
            <div className="p-4 bg-gray-800 rounded-lg border border-gray-700">
              <h3 className="text-sm font-medium text-gray-300 mb-2">Progression</h3>
              <div className="space-y-2">
                {progression.chords.map((c, i) => (
                  <div
                    key={i}
                    className={`p-2 rounded ${i === currentChord ? 'bg-primary-600' : 'bg-gray-700'}`}
                  >
                    {c.name}
                  </div>
                ))}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};
```

---

## File Structure

```
src/components/GuitarFretboard/
‚îú‚îÄ‚îÄ GuitarFretboard.tsx        // Main component (~250 lines)
‚îú‚îÄ‚îÄ FretboardCanvas.tsx        // Canvas rendering (~150 lines)
‚îú‚îÄ‚îÄ chordProgressions.ts       // Chord data (~120 lines)
‚îú‚îÄ‚îÄ constants.ts               // Guitar constants and helpers (~100 lines)
‚îî‚îÄ‚îÄ index.ts                   // Barrel export

Total NEW code: ~620 lines
REUSED: MIDIDeviceSelector, WLEDDeviceManager, colorMapping.ts, Tone.js
```

---

## Tasks / Subtasks

### Phase 1: Core Guitar Components (AC 1, 2, 3, 5)

- [ ] **Task 1.1: Create guitar constants and helpers**
  - [ ] Create `constants.ts` with GUITAR_CONSTANTS
  - [ ] Implement `createFretboardMatrix()`
  - [ ] Implement `fretboardToLEDIndex()` (serpentine wiring)
  - [ ] Implement `getMIDINoteFromFret()`

- [ ] **Task 1.2: Create chord progressions data**
  - [ ] Create `chordProgressions.ts`
  - [ ] Define TypeScript interfaces (ChordNote, Chord, ChordProgression)
  - [ ] Implement all 3 chord progressions (Jazz, Blues, Pop)

- [ ] **Task 1.3: Create FretboardCanvas component**
  - [ ] Setup canvas with useRef
  - [ ] Render 6√ó25 grid
  - [ ] Add string labels (E A D G B E)
  - [ ] Add fret numbers (0-24)
  - [ ] Implement color modes (reuse colorMapping.ts)
  - [ ] Add click handlers

- [ ] **Task 1.4: Create GuitarFretboard main component**
  - [ ] Setup state (chords, MIDI notes, color mode)
  - [ ] Initialize Tone.js guitar synth
  - [ ] Implement chord auto-advance (5 seconds)
  - [ ] Add keyboard shortcuts ('C', 'N')
  - [ ] Integrate MIDIInputManager

---

### Phase 2: WLED & MIDI Integration (AC 4, 6, 7, 8)

- [ ] **Task 2.1: Implement LED matrix data generation**
  - [ ] Create `generateLEDData()` function
  - [ ] Apply serpentine wiring mapping
  - [ ] Apply color modes to LED data
  - [ ] Test with WLED virtual preview

- [ ] **Task 2.2: Integrate WLEDDeviceManager**
  - [ ] Add WLEDDeviceManager to settings panel
  - [ ] Configure for matrix (6√ó25, serpentine)
  - [ ] Pass LED data on chord changes
  - [ ] Test with physical WLED matrix

- [ ] **Task 2.3: Integrate MIDIDeviceSelector**
  - [ ] Add MIDIDeviceSelector to settings panel
  - [ ] Wrap in CollapsiblePanel
  - [ ] Verify MIDI input works with guitar

---

### Phase 3: Responsive UI & Welcome Integration (AC 9, 10)

- [ ] **Task 3.1: Implement responsive layout**
  - [ ] Desktop: Fretboard + settings sidebar
  - [ ] Mobile: Full-width fretboard + collapsible settings
  - [ ] Add landscape mode hint (STRONG recommendation)
  - [ ] Test on iOS Safari and Android Chrome

- [ ] **Task 3.2: Add to Welcome screen**
  - [ ] Create `/guitar-fretboard` route in App.tsx
  - [ ] Add Guitar Fretboard card to WelcomeScreen
  - [ ] Use Guitar icon from Lucide React
  - [ ] Add Beta badge
  - [ ] Position after Piano Roll

---

### Phase 4: Testing & Polish

- [ ] **Task 4.1: Test chord progressions**
  - [ ] Test auto-advance (5 second timer)
  - [ ] Test manual progression cycling ('N' key)
  - [ ] Test all 3 progressions
  - [ ] Verify chord shapes correct

- [ ] **Task 4.2: Test MIDI guitar input**
  - [ ] Test with MIDI guitar pickup
  - [ ] Test polyphony
  - [ ] Test color mode toggle

- [ ] **Task 4.3: Test LED matrix output**
  - [ ] Test with physical 6√ó25 matrix
  - [ ] Verify serpentine wiring mapping
  - [ ] Test color modes on LEDs
  - [ ] Test brightness (active vs inactive)

---

## Success Metrics

- [ ] All 150 fret positions clickable and playable
- [ ] Chord progressions auto-advance every 5 seconds
- [ ] MIDI ‚Üí visual latency <20ms
- [ ] 60fps canvas rendering (desktop)
- [ ] LED matrix updates at 30 FPS
- [ ] Serpentine wiring correctly mapped
- [ ] Color modes match Python reference
- [ ] Zero code duplication (reuses MIDI, WLED, color components)

---

## Component Reuse Summary

**‚úÖ REUSING:**
- MIDIInputManager (Story 9.1) - MIDI device management
- MIDIDeviceSelector (Story 9.1) - MIDI UI component
- WLEDDeviceManager - LED matrix output
- colorMapping.ts - Chromatic/Harmonic colors
- Tone.js - Audio playback
- CollapsiblePanel - Settings panel UI
- useResponsive - Mobile/desktop breakpoints

**üìù NEW:**
- GuitarFretboard.tsx - Main guitar component
- FretboardCanvas.tsx - Canvas rendering
- chordProgressions.ts - Chord data
- constants.ts - Guitar-specific helpers

---

## Design System Compliance

- [ ] Uses Tailwind CSS classes
- [ ] Uses Lucide React icons (Guitar, Settings)
- [ ] Follows color tokens (primary-500, gray-700, etc.)
- [ ] Border radius: `rounded-lg`
- [ ] Touch targets: `min-h-[44px]`
- [ ] Responsive: Mobile-first
- [ ] Accessibility: ARIA labels, keyboard nav

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-10-10 | 1.0 | Initial story creation - Guitar Fretboard Visualizer | Claude Code |

---

## Next Steps

1. Complete Story 9.1 (Web MIDI Input Engine)
2. Complete Story 9.2 (Piano Roll Visualizer)
3. Begin Phase 1: Core Guitar Components
4. Test with MIDI guitar pickup
5. Proceed to Story 9.4: Modular Instrument Loader for /jam
