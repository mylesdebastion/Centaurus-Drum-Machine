# Story 6.1 - UX Implementation Checklist

**Purpose:** Practical checklist for developers implementing WLED Device Manager UI
**Story:** 6.1 v2.2 - Multi-Client Shared Sessions (Phase 0: WLED Component)
**Approach:** Build UX and functionality simultaneously using this checklist

---

## How to Use This Checklist

1. **Follow component order** (Empty State → Modal → Device Card → Loading/Error States)
2. **Check boxes as you implement** each UX requirement
3. **Reference Story 6.1** for detailed specifications (error messages, CSS, etc.)
4. **Test each section** before moving to next (mobile + desktop)

---

## Component 1: Empty State

### Visual Layout
- [ ] Center-aligned content (vertical + horizontal)
- [ ] WLED icon displayed (large, ~64px)
- [ ] Heading: "No WLED Devices Connected" (text-xl, font-semibold)
- [ ] Subheading: "Connect LED strips to visualize audio..." (text-sm, text-gray-400)
- [ ] Primary CTA: "+ Add Your First WLED Device" (btn-primary, full-width mobile, auto-width desktop)
- [ ] Help link: "Setup Guide" → `/docs/wled-setup` (text-sm, text-primary-500)

### Responsive
- [ ] Mobile: Full-width button, spacing p-8
- [ ] Desktop: Max-width 400px, centered

### Accessibility
- [ ] Button has `aria-label="Add your first WLED device"`
- [ ] Help link has proper contrast (WCAG AA)

**Test:** Load component with no devices, verify empty state shows correctly on mobile + desktop

---

## Component 2: Add Device Modal

### Layout & Fields
- [ ] Modal slides up from bottom (mobile) or centered (desktop)
- [ ] Device Name input:
  - [ ] Placeholder: "My LED Strip"
  - [ ] Optional field (auto-generate if blank: "WLED Device 1")
  - [ ] Max 30 characters
  - [ ] `autocapitalize="words"` `autocorrect="off"`
- [ ] IP Address input:
  - [ ] Placeholder: "192.168.1.50"
  - [ ] Required field
  - [ ] `inputmode="decimal"` for mobile numeric keyboard
  - [ ] Font size 16px minimum (prevent iOS zoom)
- [ ] Device Type dropdown:
  - [ ] Options: Auto-detect, Strip, Matrix
  - [ ] Default: "Auto-detect"
- [ ] Cancel button (btn-secondary)
- [ ] Add Device button (btn-primary, **disabled until valid IP**)

### Input Validation
- [ ] IP regex: `\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}`
- [ ] Validation on blur event
- [ ] Invalid IP → Red border (`border-red-500`)
- [ ] Error message inline: "Invalid IP (example: 192.168.1.50)" (text-red-500, text-sm)
- [ ] Disable "Add Device" button until IP valid
- [ ] Trim whitespace on submit

### Behavior
- [ ] Auto-focus IP input on modal open
- [ ] Backdrop click → Dismiss modal
- [ ] Escape key → Dismiss modal
- [ ] Drag-to-dismiss on mobile (swipe down gesture)
- [ ] On submit → Close modal, create device card with "Connecting..." status

### Accessibility
- [ ] Modal has `role="dialog"` `aria-modal="true"`
- [ ] Focus trap within modal (tab doesn't escape)
- [ ] First input auto-focused
- [ ] Error messages associated with inputs (`aria-describedby`)

**Test:** Open modal, try invalid IP (see error), enter valid IP (button enables), submit (modal closes, device appears)

---

## Component 3: Device Card - Core Layout

### Card Structure
- [ ] Grid layout: 1 col (mobile), 2 cols (sm), 3 cols (lg), 4 cols (xl)
- [ ] Card padding: p-4 (mobile), p-6 (desktop)
- [ ] Border: border border-gray-700
- [ ] Border radius: rounded-lg
- [ ] Background: bg-gray-800

### Header Section (Always Visible)
- [ ] Device name (text-base, font-semibold, left-aligned)
- [ ] Connection status indicator (12px circle, top-right)
  - [ ] Connected: Green #10b981
  - [ ] Connecting: Blue #3b82f6 (pulse animation)
  - [ ] Reconnecting: Yellow #eab308 (pulse animation)
  - [ ] Error: Red #ef4444 (static)
- [ ] Status text next to indicator (text-sm)
  - [ ] "Connected" | "Connecting..." | "Reconnecting Attempt 2/3" | "Connection Failed"
- [ ] IP address below name (text-sm, text-gray-400)
- [ ] Enable toggle (top-right, switch component)

### Virtual Preview Section
- [ ] Shows if `showVirtualPreview={true}` (default)
- [ ] Strip: Horizontal row of colored divs (8px × 8px each, gap-1)
- [ ] Matrix: 2D grid matching matrixConfig dimensions
- [ ] Skeleton loader while connecting (shimmer animation)
- [ ] Real-time color updates from ledData prop
- [ ] Placeholder if no data after 10s: "Waiting for audio data..." (text-xs, text-gray-500, center)

### Action Buttons
- [ ] Test button: Icon + "Test" text (btn-secondary, sm)
- [ ] Settings button: Gear icon only (btn-secondary, sm, tooltip "Settings")
- [ ] Delete button: Trash icon only (btn-danger, sm, tooltip "Delete device")
- [ ] Button spacing: gap-2
- [ ] Min touch target: 44x44px on mobile

### FPS Counter
- [ ] Bottom-right corner
- [ ] Text: "60 FPS" or "0 FPS" (text-xs, text-gray-500)
- [ ] Updates in real-time

**Test:** Device card displays correctly, all sections visible, buttons clickable, FPS updates

---

## Component 4: Device Card - Expandable Settings

### Expand/Collapse Behavior
- [ ] Click settings button → Expand panel (smooth 200ms transition)
- [ ] Click again or outside → Collapse panel
- [ ] Tap card header (mobile) → Toggle expand/collapse
- [ ] Escape key → Collapse if expanded
- [ ] Settings icon rotates 180° when expanded (transition 200ms)

### Settings Panel Content (Collapsed by Default)
- [ ] LED Count input (number, min 1, max 1000)
- [ ] Brightness slider (0-255, shows percentage: "80%")
- [ ] Auto-reconnect checkbox (checked by default)
- [ ] Reverse direction checkbox
- [ ] Test Pattern dropdown:
  - [ ] Options: Rainbow, Solid Red, Off
  - [ ] Send pattern on select (immediate feedback on LEDs)
- [ ] (If matrix) Matrix width, height, serpentine, orientation fields

### Field Spacing
- [ ] Vertical spacing: space-y-3
- [ ] Labels: text-sm, text-gray-300
- [ ] Inputs: text-sm, bg-gray-700, border-gray-600

**Test:** Expand settings, modify values, collapse, re-expand (values persist), test pattern works

---

## Component 5: Loading States

### L1: Connecting (Initial Connection)
- [ ] Blue pulsing status indicator (#3b82f6)
- [ ] Status text: "Connecting..."
- [ ] Virtual preview: Skeleton shimmer animation
  ```css
  background: linear-gradient(90deg, #e5e7eb 25%, #f3f4f6 50%, #e5e7eb 75%);
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
  ```
- [ ] Action buttons: Disabled (`opacity-50 cursor-not-allowed`)
- [ ] Timeout: 5 seconds → Switch to Error state (E1)

### L2: Reconnecting (Auto-reconnect After Disconnect)
- [ ] Yellow pulsing status indicator (#eab308)
- [ ] Status text: "Reconnecting Attempt X/3"
- [ ] Virtual preview: Frozen on last frame
- [ ] FPS: Shows "0 FPS"
- [ ] After 3 failures → Switch to Error state (E5) with manual Retry button

### L3: First Data Load
- [ ] Virtual preview: Skeleton shimmer until first ledData received
- [ ] After first data: Normal real-time updates
- [ ] If no data after 10s: "Waiting for audio data..." placeholder

**Test:** Disconnect WLED during operation (triggers L2), reconnect (success), disconnect Wi-Fi (triggers timeout)

---

## Component 6: Error States

### E1: Connection Timeout (5 seconds)
- [ ] Red status indicator (#ef4444, static)
- [ ] Status text: "Connection Failed"
- [ ] Error message below: "Could not connect to 192.168.1.50. Check IP address and Wi-Fi network."
- [ ] [Retry] button appears on card
- [ ] Click Retry → Attempt reconnection (max 3 attempts: 1s, 2s, 4s backoff)

### E2: Invalid IP Address (Modal)
- [ ] Red border on IP input (`border-red-500`)
- [ ] Error message inline: "Invalid IP address (example: 192.168.1.50)" (text-red-500, text-sm)
- [ ] Real-time validation on blur
- [ ] "Add Device" button disabled

### E3: WLED Not Found
- [ ] Red status + info icon
- [ ] Message: "Device found but WLED not responding. Verify WLED firmware installed."
- [ ] [Help] link → Opens `/docs/wled-setup#firmware`
- [ ] Manual retry available

### E4: Network Error
- [ ] Red status + network offline icon
- [ ] Message: "Network error. Verify you're on the same Wi-Fi network as WLED device."
- [ ] [Retry] button
- [ ] Auto-retry when browser fires 'online' event (`window.addEventListener('online', ...)`)

### E5: Connection Dropped (Runtime)
- [ ] Yellow "Reconnecting..." → Red "Disconnected" (after 3 attempts)
- [ ] Toast notification: "[Device Name] disconnected. Reconnecting..." (2s duration)
- [ ] Virtual preview: Frozen
- [ ] FPS: 0
- [ ] Manual [Reconnect] button after failures

### E6: Data Send Failure
- [ ] FPS drops to 0
- [ ] Warning icon on status
- [ ] Tooltip on hover: "Data send failed - connection may be unstable"
- [ ] Auto-retry on next frame
- [ ] Console.error logged

**Test:** Each error scenario (wrong IP, timeout, disconnect Wi-Fi, etc.), verify correct error shows

---

## Component 7: Data Flow Indicators

### Visual Implementation
- [ ] Position: Top-right of card, 12px circle
- [ ] Idle: Gray #6b7280, static
- [ ] Receiving: Blue #3b82f6, pulse (1s duration, opacity 0.5 → 1.0)
- [ ] Sending: Green #10b981, pulse (0.8s duration, opacity 0.5 → 1.0)
- [ ] Error: Red #ef4444, static

### Tooltips
- [ ] Idle: "Connected, waiting for audio data"
- [ ] Receiving: "Receiving visualization data"
- [ ] Sending: "Sending to WLED (60 FPS)"
- [ ] Error: "Connection lost - Click to retry"

### State Transitions
- [ ] Idle → Receiving: When `ledData` prop changes
- [ ] Receiving → Sending: When `ws.send()` succeeds
- [ ] Sending → Idle: When no updates for 2 seconds
- [ ] Any → Error: On WebSocket error

**Test:** Play audio (see Receiving → Sending), pause (see Sending → Idle after 2s), disconnect (see Error)

---

## Component 8: Accessibility

### Keyboard Navigation
- [ ] Tab order: Enable → Test → Settings → Delete → (if expanded) Settings fields
- [ ] Enter/Space: Activate buttons
- [ ] Escape: Collapse settings panel
- [ ] Arrow keys: Navigate settings inputs

### Touch Targets (Mobile)
- [ ] All buttons: 44x44px minimum
- [ ] Action buttons: 8px spacing
- [ ] Card header: Entire area tappable (for expand/collapse)

### Screen Reader
- [ ] Connection status: "Guitar Neck, connected, 60 FPS"
- [ ] Test button: `aria-label="Test pattern for Guitar Neck"`
- [ ] Delete button: `aria-label="Delete Guitar Neck device"` + confirmation dialog
- [ ] Settings panel: `aria-expanded="true|false"` on button

### Focus States
- [ ] All interactive elements: 2px focus ring (primary-500)
- [ ] Focus visible on keyboard nav only (`:focus-visible`)

### Color Contrast
- [ ] Green #10b981 on dark: ✅ Passes WCAG AA
- [ ] Red #ef4444 on dark: ✅ Passes WCAG AA
- [ ] Blue #3b82f6 on dark: ✅ Passes WCAG AA
- [ ] Gray #6b7280 on dark: ✅ Passes WCAG AA

**Test:** Navigate with keyboard only, use screen reader (NVDA/VoiceOver), check contrast with browser devtools

---

## Component 9: Mobile-Specific UX

### Touch Interactions
- [ ] Tap card header → Expand/collapse (no 300ms delay with `touch-action: manipulation`)
- [ ] Tap enable toggle → Enable/disable (stopPropagation to prevent card expand)
- [ ] Long press card (1s) → Context menu (Edit, Delete, Copy IP)
- [ ] Swipe left → Quick delete with undo toast

### Floating Action Button (Mobile Only)
- [ ] FAB style button at bottom-right
- [ ] Position: `bottom: max(16px, env(safe-area-inset-bottom) + 8px)`
- [ ] Z-index above grid
- [ ] Slide in animation on mount
- [ ] Hide on scroll down, show on scroll up
- [ ] Haptic feedback (`navigator.vibrate(50)` if supported)

### Modal (Mobile)
- [ ] Slide up from bottom (not centered)
- [ ] Full-width (mobile), 80% width (tablet)
- [ ] Drag-to-dismiss swipe down gesture
- [ ] Auto-focus IP input (shows keyboard)
- [ ] Backdrop tap to dismiss

### iOS Safari
- [ ] IP input: `inputmode="decimal"`
- [ ] Device name: `autocapitalize="words"` `autocorrect="off"`
- [ ] All inputs: `font-size: 16px` min (prevent zoom)
- [ ] Safe area insets respected

### Android Chrome
- [ ] Material ripple on buttons (Tailwind: `active:scale-95`)
- [ ] Snackbar for toasts (bottom positioning)
- [ ] Bottom sheet style modals

**Test:** iOS Safari + Chrome Android, verify gestures, keyboard, FAB positioning, no zoom on input focus

---

## Final Testing Checklist

### Functionality
- [ ] Add device → Connects successfully
- [ ] Enable/disable toggle → WebSocket connects/disconnects
- [ ] Test pattern → LEDs respond
- [ ] Delete device → Removed from grid + localStorage
- [ ] Settings persist → Reload page, settings unchanged
- [ ] Multiple devices → All work independently

### Responsive
- [ ] Mobile (375px): 1 column, FAB visible, modal slides up
- [ ] Tablet (768px): 2 columns, proper spacing
- [ ] Desktop (1024px+): 3-4 columns, expanded layout
- [ ] Breakpoint transitions: No remounting (WebSocket stays connected)

### Error Handling
- [ ] Wrong IP → E2 inline validation
- [ ] Timeout → E1 error with retry
- [ ] Network offline → E4 error with auto-retry
- [ ] Disconnect during operation → E5 reconnect flow

### Accessibility
- [ ] Keyboard navigation works
- [ ] Screen reader announces all states
- [ ] Touch targets 44x44px minimum
- [ ] Color contrast passes WCAG AA
- [ ] Focus visible on keyboard nav

### Cross-Browser
- [ ] Chrome Desktop ✅
- [ ] Firefox Desktop ✅
- [ ] Safari Desktop ✅
- [ ] iOS Safari ✅
- [ ] Chrome Android ✅

---

## Developer Notes

**Copy/Paste Ready Error Messages** (from Story 6.1):
- E1: "Could not connect to 192.168.1.50. Check IP address and Wi-Fi network."
- E2: "Invalid IP address (example: 192.168.1.50)"
- E3: "Device found but WLED not responding. Verify WLED firmware installed."
- E4: "Network error. Verify you're on the same Wi-Fi network as WLED device."
- E5: "[Device Name] disconnected. Reconnecting..."
- E6: "Data send failed - connection may be unstable"

**Copy/Paste Ready Tooltips:**
- Idle: "Connected, waiting for audio data"
- Receiving: "Receiving visualization data"
- Sending: "Sending to WLED (60 FPS)"
- Error: "Connection lost - Click to retry"

**CSS Animations** (from Story 6.1):
```css
/* Skeleton shimmer */
@keyframes shimmer {
  0% { background-position: -200% 0; }
  100% { background-position: 200% 0; }
}

/* Pulse */
@keyframes pulse {
  0%, 100% { opacity: 0.5; }
  50% { opacity: 1; }
}
```

---

**Completion:** When all checkboxes checked, Phase 0 UX is complete! 🎉
