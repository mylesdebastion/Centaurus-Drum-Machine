# Story 21.2: Install Analytics & Tracking Infrastructure

**Epic**: 21 - User Acquisition & Revenue Generation
**Status**: ðŸ“‹ Draft
**Priority**: ðŸ”´ Critical (Week 1)
**Estimated Effort**: 3-4 hours
**Owner**: Solo Dev

---

## Story

As a **product owner tracking user acquisition**,
I want **comprehensive analytics installed and tracking all key user actions**,
So that **I can measure success, identify drop-off points, and make data-driven decisions**.

---

## Context

**Problem**: Currently only Vercel Analytics installed (basic pageviews). We cannot:
- Track sign-ups, activations, engagement, retention
- Measure which channels drive best users
- Identify where users drop off in funnels
- Calculate ROI on paid marketing campaigns
- Understand which features are used most

**Impact**: Flying blind, can't optimize acquisition or product

**Reference**: `docs/marketing/06-analytics-dashboard.md` (complete tracking guide)

---

## Acceptance Criteria

### Must-Have
- [ ] **Google Analytics 4 (GA4) installed** and tracking:
  - Page views (all pages)
  - User sign-ups
  - Sessions (unique visitors)
  - Traffic sources (organic, referral, social, paid)
- [ ] **Custom events tracking** for key user actions:
  - `sign_up` - User creates account
  - `first_module_loaded` - User loads first module
  - `first_project_created` - User creates first project
  - `project_saved` - User saves project
  - `jam_session_started` - User creates jam session
  - `jam_session_joined` - User joins jam session
  - `pro_trial_started` - User starts Pro trial
  - `pro_subscribed` - User subscribes to Pro
- [ ] **UTM parameter capture** for attribution tracking
  - Capture utm_source, utm_medium, utm_campaign, utm_content
  - Store in user profile or analytics
- [ ] **Google Search Console connected** to www.audiolux.app
  - Verify ownership (HTML file or meta tag)
  - Submit sitemap.xml
  - Monitor indexing status

### Nice-to-Have
- [ ] Hotjar installed (heatmaps, session recordings)
  - Track homepage (www.audiolux.app)
  - Track Studio onboarding flow (jam.audiolux.app)
- [ ] Weekly analytics dashboard (Google Sheets template)
- [ ] Automated weekly report email

---

## Tasks

### 1. Install Google Analytics 4
- [ ] Create GA4 property at https://analytics.google.com
  - Account name: "Audiolux"
  - Property name: "Audiolux Production"
  - Set timezone, currency
  - Copy Measurement ID (G-XXXXXXXXXX)
- [ ] Install GA4 in codebase
  - Create `src/utils/analytics.ts` (utility functions)
  - Install dependency: `npm install react-ga4`
  - Initialize GA4 in `src/main.tsx`
  - Add Measurement ID to environment variables (`.env`)
- [ ] Add GA4 script to www.audiolux.app (marketing site)
- [ ] Test GA4 installation (Real-Time report should show activity)

### 2. Implement Custom Event Tracking
- [ ] Create event tracking functions in `src/utils/analytics.ts`
  ```typescript
  export const trackEvent = (category: string, action: string, label?: string) => {
    ReactGA.event({ category, action, label });
  };
  ```
- [ ] Add event tracking to key user actions:
  - **Sign-up**: `src/components/Auth/SignUp.tsx`
    ```typescript
    trackEvent('Acquisition', 'sign_up', referralSource);
    ```
  - **First Module Loaded**: `src/components/Studio/ModuleLoader.tsx`
    ```typescript
    trackEvent('Activation', 'first_module_loaded', moduleName);
    ```
  - **First Project Created**: `src/hooks/useProject.ts`
    ```typescript
    if (user.projectCount === 1) {
      trackEvent('Activation', 'first_project_created');
    }
    ```
  - **Project Saved**: `src/hooks/useProject.ts`
    ```typescript
    trackEvent('Engagement', 'project_saved', projectId);
    ```
  - **Jam Session Started**: `src/components/JamSession/CreateSession.tsx`
    ```typescript
    trackEvent('Engagement', 'jam_session_started');
    ```
  - **Jam Session Joined**: `src/components/JamSession/JoinSession.tsx`
    ```typescript
    trackEvent('Engagement', 'jam_session_joined', sessionCode);
    ```

### 3. Implement UTM Parameter Capture
- [ ] Create UTM capture utility in `src/utils/analytics.ts`
  ```typescript
  export const captureUTMParameters = () => {
    const urlParams = new URLSearchParams(window.location.search);
    const utmSource = urlParams.get('utm_source');
    const utmMedium = urlParams.get('utm_medium');
    const utmCampaign = urlParams.get('utm_campaign');
    const utmContent = urlParams.get('utm_content');

    if (utmSource) {
      trackEvent('Acquisition', 'utm_capture',
        `${utmSource}|${utmMedium}|${utmCampaign}|${utmContent}`
      );

      // Store in localStorage for attribution
      localStorage.setItem('utm_source', utmSource || '');
      localStorage.setItem('utm_medium', utmMedium || '');
      localStorage.setItem('utm_campaign', utmCampaign || '');
    }
  };
  ```
- [ ] Call `captureUTMParameters()` on app load (`src/main.tsx`)
- [ ] Test UTM tracking with sample URLs:
  - jam.audiolux.app?utm_source=reddit&utm_medium=organic&utm_campaign=test

### 4. Connect Google Search Console
- [ ] Go to https://search.google.com/search-console
- [ ] Add property: www.audiolux.app
- [ ] Verify ownership (choose method):
  - Option A: Upload HTML file to `public/` directory
  - Option B: Add meta tag to `index.html`
- [ ] Submit sitemap: www.audiolux.app/sitemap.xml
- [ ] Test sitemap fetch in Search Console (should show no errors)
- [ ] Monitor "Coverage" report (pages indexed)

### 5. Install Hotjar (Nice-to-Have)
- [ ] Create Hotjar account at https://www.hotjar.com
- [ ] Add site: www.audiolux.app
- [ ] Copy Hotjar tracking code (Hotjar ID)
- [ ] Create `src/utils/hotjar.ts` (initialization script)
- [ ] Add Hotjar ID to environment variables (`.env`)
- [ ] Initialize Hotjar in `src/main.tsx`
- [ ] Test Hotjar (session recordings should appear in dashboard)
- [ ] Set up heatmaps for homepage and Studio pages

### 6. Create Weekly Dashboard (Nice-to-Have)
- [ ] Create Google Sheets template (copy from `docs/marketing/06-analytics-dashboard.md`)
- [ ] Add formulas for key metrics:
  - Weekly Active Users (WAU)
  - Sign-up rate (sign-ups / visitors)
  - Activation rate (first project / sign-ups)
  - D7 retention (users returning day 7)
  - MRR (monthly recurring revenue)
- [ ] Document how to update weekly (every Monday)

---

## Technical Implementation

### Dependencies to Install
```bash
npm install react-ga4
```

### Environment Variables to Add
```env
VITE_GA4_MEASUREMENT_ID=G-XXXXXXXXXX
VITE_HOTJAR_ID=XXXXXXX
```

### Files to Create
- `src/utils/analytics.ts` - GA4 initialization & event tracking
- `src/utils/hotjar.ts` - Hotjar initialization (optional)

### Files to Modify
- `src/main.tsx` - Initialize analytics on app load
- `src/components/Auth/SignUp.tsx` - Track sign-ups
- `src/components/Studio/ModuleLoader.tsx` - Track module loads
- `src/hooks/useProject.ts` - Track project creation/saves
- `src/components/JamSession/*.tsx` - Track jam session events

### Privacy Considerations
- [ ] Anonymize IP addresses in GA4 (privacy setting)
- [ ] Add cookie consent banner (required for EU/GDPR)
- [ ] Update privacy policy to mention analytics tracking
- [ ] Respect "Do Not Track" browser settings

---

## Validation & Testing

### Manual Testing Checklist
- [ ] Open GA4 Real-Time report
- [ ] Visit jam.audiolux.app - should see 1 active user
- [ ] Create account - `sign_up` event should fire
- [ ] Load module - `first_module_loaded` event should fire
- [ ] Create project - `first_project_created` event should fire
- [ ] Check GA4 Events report (should see all custom events)
- [ ] Test UTM parameters:
  - Visit: jam.audiolux.app?utm_source=test&utm_medium=manual&utm_campaign=dev-test
  - Check GA4: utm_capture event should show in Events report
- [ ] Test Hotjar (if installed):
  - Visit www.audiolux.app
  - Check Hotjar dashboard for session recording

### Analytics Validation
- [ ] Verify 24 hours of data collection
- [ ] Confirm event counts match expectations (roughly)
- [ ] Check for any tracking errors in browser console
- [ ] Verify UTM parameters are captured correctly
- [ ] Confirm Google Search Console shows submitted sitemap

---

## Success Metrics

**Primary KPIs** (After 1 Week):
- GA4 tracking 100% of sessions (no gaps in data)
- All 8 custom events firing correctly
- UTM parameters captured for 100% of campaign traffic
- Google Search Console shows 10+ indexed pages

**Secondary KPIs**:
- Hotjar capturing 20+ session recordings per week
- Weekly dashboard updated (baseline metrics established)

---

## Dependencies

**Blockers**: None (can start immediately)

**Required Access**:
- Google Analytics account
- Google Search Console account
- Codebase access (jam.audiolux.app)
- Environment variables access (.env)

**Optional Access**:
- Hotjar account (nice-to-have)

---

## Risks & Mitigation

### Risk 1: GA4 Complexity
**Risk**: GA4 has learning curve, may configure incorrectly
**Mitigation**: Follow `docs/marketing/06-analytics-dashboard.md` step-by-step, use GA4 debugger extension

### Risk 2: Privacy Compliance
**Risk**: Analytics tracking without consent may violate GDPR/CCPA
**Mitigation**: Add cookie consent banner (Week 2), update privacy policy, anonymize IPs

### Risk 3: Event Tracking Bugs
**Risk**: Custom events may not fire due to code bugs
**Mitigation**: Test thoroughly in staging, use GA4 DebugView, add error handling

---

## Definition of Done

- [ ] All acceptance criteria met
- [ ] GA4 installed and tracking pageviews + custom events
- [ ] UTM parameter capture working
- [ ] Google Search Console connected and sitemap submitted
- [ ] Manual testing checklist completed (all events firing)
- [ ] No tracking errors in browser console
- [ ] Privacy considerations documented (cookie consent plan)
- [ ] Weekly dashboard template created (Google Sheets)
- [ ] Story marked as "Review" status

---

## Dev Agent Record

### Agent Model Used
[To be filled by dev agent]

### Completion Notes
[To be filled by dev agent]

### File List
[To be filled by dev agent]

### Change Log
[To be filled by dev agent]

### Debug Log References
[To be filled by dev agent]

---

## Related Stories
- **Story 21.1**: Fix Marketing Site (track demo video plays)
- **Story 21.4**: Launch Community Blitz (track UTM parameters from Reddit/HN)
- **Story 21.9**: Launch Paid Ads (track CPA, ROI)

---

## Document Version

**Version**: 1.0
**Created**: 2025-10-25
**Last Updated**: 2025-10-25
**Status**: ðŸ“‹ **Draft - Ready for Development**
