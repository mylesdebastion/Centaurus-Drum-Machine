# Story 22.5: Reusable Tutorial Component Library

**Epic**: 22 - AI-Native Product-Led Growth Flywheel
**Status**: ðŸ“‹ Draft
**Priority**: ðŸŸ¡ Medium (efficiency improvement)
**Estimated Effort**: 2-3 hours
**Owner**: Solo Dev

---

## Story

As a **developer building persona-specific onboarding tutorials**,
I want **a library of reusable tutorial components that can be composed into different paths**,
So that **I can create 6 persona tutorials efficiently without duplicating code or effort**.

---

## Context

**Problem**: Story 22.1 defines 6 persona-specific tutorial paths, but many steps are shared across personas:
- "Musician" and "Producer" both need "Quick Beat Creation"
- "Deaf/HOH", "Educator", and "Visual Learner" all use "Visual Music Theory"
- "Educator" and "Enterprise" share "Collaboration Demo"

Without reusable components, we'd duplicate the same tutorial steps 6 times, leading to:
- Maintenance nightmare (fix bugs in 6 places)
- Inconsistent experiences across personas
- Wasted development time

**Solution**: Build a component library where persona tutorials compose smaller, reusable tutorial modules. Each module is self-contained, tested once, and reused across multiple paths.

**Philosophy**: "Write once, compose many times" - like Lego blocks for tutorials.

**Reference**:
- `docs/marketing/10-persona-research-redesign.md` (component reuse matrix)
- `docs/stories/22.1-multi-path-onboarding.story.md` (persona paths using components)

---

## Component Reuse Matrix

From persona research redesign:

| Component | Musician (m) | Deaf (d) | Educator (e) | Visual (v) | Producer (p) | Enterprise (i) |
|-----------|--------------|----------|--------------|------------|--------------|----------------|
| Quick Beat Creation | âœ… | - | - | - | âœ… | - |
| Visual Music Theory | - | âœ… | âœ… | âœ… | - | âœ… |
| Color Sequencer | - | âœ… | - | âœ… | - | - |
| Accessibility Tour | - | âœ… | âœ… | - | - | âœ… |
| Collaboration Demo | âœ… | - | âœ… | - | âœ… | âœ… |
| Advanced Features | - | - | - | - | âœ… | âœ… |
| Pricing & Support | - | - | - | - | - | âœ… |

**Efficiency gain**: 7 reusable components used 19 times across 6 personas = 2.7x reuse factor

---

## Acceptance Criteria

### Must-Have

- [ ] **7 Reusable Tutorial Components** (see details below):
  1. Quick Beat Creation
  2. Visual Music Theory
  3. Color Sequencer
  4. Accessibility Tour
  5. Collaboration Demo
  6. Advanced Features
  7. Pricing & Support

- [ ] **Component Library Structure**:
  - Each component is a self-contained React component
  - Accepts `onComplete` callback (fired when step done)
  - Accepts `personaContext` prop (for messaging customization)
  - Returns consistent structure (`<TutorialModule>` wrapper)
  - Includes confetti/celebration logic
  - Tracks completion internally

- [ ] **Composition Pattern**:
  - Persona paths compose components in specific order
  - Example: `MusicianPath = [QuickBeatCreation, CollaborationDemo]`
  - Example: `DeafPersonPath = [VisualMusicTheory, ColorSequencer, AccessibilityTour]`
  - Progress tracked across composed components

- [ ] **Documentation**:
  - Component API reference (props, events, usage)
  - Examples of composing persona paths
  - Design patterns for creating new tutorial components

### Nice-to-Have

- [ ] Visual component preview tool (Storybook)
- [ ] A/B testing for component variations
- [ ] Analytics for which components have best completion rates

---

## Reusable Components Detail

### Component 1: Quick Beat Creation

**Used by**: Musician (m), Producer (p)

**Purpose**: Guide user to create a simple 4/4 kick-snare beat in 30 seconds

**Steps**:
1. "Tap 4 boxes to create a kick drum rhythm" (12s)
2. "Add snare on beats 2 and 4" (8s)
3. "Press play to hear your music" (5s)

**Customization**:
- Musician: "Make a beat in 30 seconds. No download needed."
- Producer: "Create a pattern - like Ableton racks, in your browser"

**Props**:
```typescript
interface QuickBeatCreationProps {
  personaContext: 'musician' | 'producer';
  onComplete: () => void;
}
```

---

### Component 2: Visual Music Theory

**Used by**: Deaf/HOH (d), Educator (e), Visual Learner (v), Enterprise (i)

**Purpose**: Teach color-coded pitch system (Red = C, Orange = D, etc.)

**Steps**:
1. "Colors show pitch. Red = C, Orange = D, Yellow = E..." (10s)
2. "Click a C Major chord" (8s)
3. "See the colors light up" (5s)

**Customization**:
- Deaf/HOH: "Make music. No hearing required."
- Educator: "Your students will learn music in 30 seconds"
- Visual Learner: "No sheet music needed. If you can see a pattern, you can make music."
- Enterprise: "Inclusive for Deaf, HOH, visual learners"

**Props**:
```typescript
interface VisualMusicTheoryProps {
  personaContext: 'deaf-person' | 'educator' | 'visual-learner' | 'enterprise';
  onComplete: () => void;
  showChordBuilder?: boolean; // Default true
}
```

---

### Component 3: Color Sequencer

**Used by**: Deaf/HOH (d), Visual Learner (v)

**Purpose**: Create rhythm pattern with visual-only feedback

**Steps**:
1. "Create a rhythm pattern (watch the grid, no sound needed)" (10s)
2. "Tap kick drum pattern [0, 4, 8, 12]" (8s)
3. "See visual feedback on each tap" (5s)

**Customization**:
- Deaf/HOH: "No hearing required."
- Visual Learner: "The grid is rhythm. Light boxes = beats."

**Props**:
```typescript
interface ColorSequencerProps {
  personaContext: 'deaf-person' | 'visual-learner';
  onComplete: () => void;
  showWaveformVisualizer?: boolean; // Default true for deaf-person
}
```

---

### Component 4: Accessibility Tour

**Used by**: Deaf/HOH (d), Educator (e), Enterprise (i)

**Purpose**: Highlight accessibility features (visual feedback, keyboard nav, screen readers)

**Steps**:
1. "All audio has visual alternatives (waveform, colors)" (8s)
2. "Keyboard accessible (arrow keys navigate)" (7s)
3. "Screen reader compatible" (5s)

**Customization**:
- Deaf/HOH: "Music for everyone. No hearing required."
- Educator: "Accessible for all students"
- Enterprise: "WCAG 2.1 AA compliant, Section 508 certified"

**Props**:
```typescript
interface AccessibilityTourProps {
  personaContext: 'deaf-person' | 'educator' | 'enterprise';
  onComplete: () => void;
  showComplianceBadge?: boolean; // Default true for enterprise
}
```

---

### Component 5: Collaboration Demo

**Used by**: Musician (m), Educator (e), Producer (p), Enterprise (i)

**Purpose**: Show real-time jam session feature

**Steps**:
1. "Send a link - instant jam session" (8s)
2. "See others' beats in real-time" (7s)
3. "No download, no account required" (5s)

**Customization**:
- Musician: "Jam with a friend"
- Educator: "Students work together in real-time"
- Producer: "Instant collaboration"
- Enterprise: "Classroom sessions (30+ students)"

**Props**:
```typescript
interface CollaborationDemoProps {
  personaContext: 'musician' | 'educator' | 'producer' | 'enterprise';
  onComplete: () => void;
  showMultiUserPreview?: boolean; // Default true for enterprise
}
```

---

### Component 6: Advanced Features

**Used by**: Producer (p), Enterprise (i)

**Purpose**: Tease pro-level features (modular workflow, MIDI export, automation)

**Steps**:
1. "Drag-drop modules for modular workflow" (8s)
2. "Export MIDI, sync with DAW" (7s)
3. "Automation and effects" (5s)

**Customization**:
- Producer: "Modular DAW, no download needed"
- Enterprise: "Professional features for advanced students"

**Props**:
```typescript
interface AdvancedFeaturesProps {
  personaContext: 'producer' | 'enterprise';
  onComplete: () => void;
  showPricingCTA?: boolean; // Default true for producer
}
```

---

### Component 7: Pricing & Support

**Used by**: Enterprise (i)

**Purpose**: Show pricing tiers, demo booking, customer success

**Steps**:
1. "Enterprise licenses: $199/yr (30 seats)" (8s)
2. "Dedicated support, onboarding training" (7s)
3. "Schedule enterprise demo with our team" (5s)

**Customization**: Enterprise-only

**Props**:
```typescript
interface PricingSupportProps {
  onComplete: () => void;
  showDemoBookingCTA?: boolean; // Default true
}
```

---

## Technical Implementation

### File Structure

```
src/
  components/
    Onboarding/
      TutorialComponents/
        index.ts                      # Export all components
        TutorialModule.tsx            # Base wrapper component
        QuickBeatCreation.tsx         # Component 1
        VisualMusicTheory.tsx         # Component 2
        ColorSequencer.tsx            # Component 3
        AccessibilityTour.tsx         # Component 4
        CollaborationDemo.tsx         # Component 5
        AdvancedFeatures.tsx          # Component 6
        PricingSupport.tsx            # Component 7
      paths/
        MusicianPath.tsx              # Composes: [1, 5]
        DeafPersonPath.tsx            # Composes: [2, 3, 4]
        EducatorPath.tsx              # Composes: [2, 4, 5]
        VisualLearnerPath.tsx         # Composes: [2, 3]
        ProducerPath.tsx              # Composes: [1, 5, 6]
        EnterprisePath.tsx            # Composes: [2, 4, 5, 6, 7]
```

---

### Core Implementation: TutorialModule (Base Component)

```tsx
// src/components/Onboarding/TutorialComponents/TutorialModule.tsx

import React, { useState } from 'react';
import Confetti from 'react-confetti';
import { useWindowSize } from 'react-use';

export interface TutorialStep {
  id: string;
  instruction: string;
  emphasis?: string;
  highlight?: string;  // CSS selector
  waitFor: string;     // Custom event name
  duration?: number;   // Estimated duration in seconds
}

interface TutorialModuleProps {
  title: string;
  steps: TutorialStep[];
  onComplete: () => void;
  showConfetti?: boolean;
  celebrationMessage?: string;
}

export const TutorialModule: React.FC<TutorialModuleProps> = ({
  title,
  steps,
  onComplete,
  showConfetti = true,
  celebrationMessage
}) => {
  const [currentStep, setCurrentStep] = useState(0);
  const [isComplete, setIsComplete] = useState(false);
  const { width, height } = useWindowSize();

  const step = steps[currentStep];

  const handleStepComplete = () => {
    if (currentStep < steps.length - 1) {
      setCurrentStep(currentStep + 1);
    } else {
      setIsComplete(true);
      if (showConfetti) {
        // Show confetti for 2 seconds
        setTimeout(() => onComplete(), 2000);
      } else {
        onComplete();
      }
    }
  };

  return (
    <div className="tutorial-module">
      {isComplete && showConfetti && (
        <Confetti width={width} height={height} recycle={false} />
      )}

      {!isComplete ? (
        <div className="tutorial-step">
          <div className="tutorial-progress mb-4">
            <span className="text-sm text-gray-400">
              Step {currentStep + 1} of {steps.length}
            </span>
          </div>

          <h3 className="text-xl font-semibold text-white mb-2">
            {step.instruction}
          </h3>

          {step.emphasis && (
            <p className="text-gray-300 mb-4">{step.emphasis}</p>
          )}

          {/* Trigger next step via custom event */}
          <StepWatcher eventName={step.waitFor} onEvent={handleStepComplete} />
        </div>
      ) : (
        <div className="tutorial-complete text-center">
          <div className="text-4xl mb-4">ðŸŽ‰</div>
          <h3 className="text-2xl font-bold text-white mb-2">
            {celebrationMessage || 'Great job!'}
          </h3>
        </div>
      )}
    </div>
  );
};

// Helper: Event listener for step completion
const StepWatcher: React.FC<{ eventName: string; onEvent: () => void }> = ({
  eventName,
  onEvent
}) => {
  React.useEffect(() => {
    const handler = () => onEvent();
    window.addEventListener(eventName, handler);
    return () => window.removeEventListener(eventName, handler);
  }, [eventName, onEvent]);

  return null;
};
```

---

### Example: QuickBeatCreation Component

```tsx
// src/components/Onboarding/TutorialComponents/QuickBeatCreation.tsx

import React from 'react';
import { TutorialModule, TutorialStep } from './TutorialModule';

interface QuickBeatCreationProps {
  personaContext: 'musician' | 'producer';
  onComplete: () => void;
}

export const QuickBeatCreation: React.FC<QuickBeatCreationProps> = ({
  personaContext,
  onComplete
}) => {
  const hookMessages = {
    musician: 'Make a beat in 30 seconds. No download needed.',
    producer: 'Create a pattern - like Ableton racks, in your browser'
  };

  const steps: TutorialStep[] = [
    {
      id: 'hook',
      instruction: hookMessages[personaContext],
      waitFor: 'tutorial:hook-acknowledged',
      duration: 3
    },
    {
      id: 'kick',
      instruction: 'Tap 4 boxes to create a kick drum rhythm',
      highlight: '.track-kick',
      waitFor: 'sequencer:kick-pattern-complete',
      duration: 12
    },
    {
      id: 'snare',
      instruction: 'Add snare on beats 2 and 4',
      highlight: '.track-snare',
      waitFor: 'sequencer:snare-pattern-complete',
      duration: 8
    },
    {
      id: 'play',
      instruction: 'Press play to hear your music',
      highlight: '.play-button',
      waitFor: 'playback:started',
      duration: 5
    }
  ];

  return (
    <TutorialModule
      title="Quick Beat Creation"
      steps={steps}
      onComplete={onComplete}
      celebrationMessage="You just made music in your browser ðŸŽ¹"
    />
  );
};
```

---

### Example: Composing Persona Path

```tsx
// src/components/Onboarding/paths/MusicianPath.tsx

import React, { useState } from 'react';
import { QuickBeatCreation } from '../TutorialComponents/QuickBeatCreation';
import { CollaborationDemo } from '../TutorialComponents/CollaborationDemo';
import { CelebrationMoment } from '../CelebrationMoment';

interface MusicianPathProps {
  referralCode: string | null;
}

export const MusicianPath: React.FC<MusicianPathProps> = ({ referralCode }) => {
  const [currentComponent, setCurrentComponent] = useState(0);

  const components = [
    <QuickBeatCreation
      key="quick-beat"
      personaContext="musician"
      onComplete={() => setCurrentComponent(1)}
    />,
    <CollaborationDemo
      key="collaboration"
      personaContext="musician"
      onComplete={() => setCurrentComponent(2)}
    />,
    <CelebrationMoment
      key="celebration"
      persona="musician"
      referralCode={referralCode}
    />
  ];

  return (
    <div className="musician-path">
      {components[currentComponent]}
    </div>
  );
};
```

---

### Example: Composing Complex Path (Enterprise)

```tsx
// src/components/Onboarding/paths/EnterprisePath.tsx

import React, { useState } from 'react';
import { VisualMusicTheory } from '../TutorialComponents/VisualMusicTheory';
import { AccessibilityTour } from '../TutorialComponents/AccessibilityTour';
import { CollaborationDemo } from '../TutorialComponents/CollaborationDemo';
import { AdvancedFeatures } from '../TutorialComponents/AdvancedFeatures';
import { PricingSupport } from '../TutorialComponents/PricingSupport';
import { CelebrationMoment } from '../CelebrationMoment';

interface EnterprisePathProps {
  referralCode: string | null;
}

export const EnterprisePath: React.FC<EnterprisePathProps> = ({ referralCode }) => {
  const [currentComponent, setCurrentComponent] = useState(0);

  const components = [
    <VisualMusicTheory
      key="visual-theory"
      personaContext="enterprise"
      onComplete={() => setCurrentComponent(1)}
    />,
    <AccessibilityTour
      key="accessibility"
      personaContext="enterprise"
      showComplianceBadge={true}
      onComplete={() => setCurrentComponent(2)}
    />,
    <CollaborationDemo
      key="collaboration"
      personaContext="enterprise"
      showMultiUserPreview={true}
      onComplete={() => setCurrentComponent(3)}
    />,
    <AdvancedFeatures
      key="advanced"
      personaContext="enterprise"
      onComplete={() => setCurrentComponent(4)}
    />,
    <PricingSupport
      key="pricing"
      onComplete={() => setCurrentComponent(5)}
    />,
    <CelebrationMoment
      key="celebration"
      persona="enterprise"
      referralCode={referralCode}
    />
  ];

  return (
    <div className="enterprise-path">
      {components[currentComponent]}
    </div>
  );
};
```

---

## Component API Documentation

### TutorialModule (Base Component)

**Props**:
- `title: string` - Module title (for analytics)
- `steps: TutorialStep[]` - Array of tutorial steps
- `onComplete: () => void` - Callback when module complete
- `showConfetti?: boolean` - Show confetti on completion (default: true)
- `celebrationMessage?: string` - Custom celebration text

**Events Emitted**:
- `tutorial:module-started` - When module begins
- `tutorial:step-completed` - When each step completes
- `tutorial:module-completed` - When entire module done

---

## Validation & Testing

### Component Testing

**Each component must**:
- [ ] Accept required props (personaContext, onComplete)
- [ ] Fire onComplete when steps finished
- [ ] Show confetti on completion (unless disabled)
- [ ] Track analytics events
- [ ] Work in isolation (no dependencies on other components)
- [ ] Be mobile responsive

**Persona Path Testing**:
- [ ] Musician path: [QuickBeatCreation, CollaborationDemo] completes in <40s
- [ ] Deaf/HOH path: [VisualMusicTheory, ColorSequencer, AccessibilityTour] completes in <60s
- [ ] Enterprise path: [VisualMusicTheory, AccessibilityTour, CollaborationDemo, AdvancedFeatures, PricingSupport] completes in <90s

---

## Success Metrics

**Primary KPIs**:
- âœ… 7 reusable components built
- âœ… 6 persona paths composed from components
- âœ… Average 2.7x component reuse (19 uses / 7 components)
- âœ… 100% test coverage for components

**Secondary KPIs**:
- âœ… Add new persona path in <30 minutes (composing existing components)
- âœ… Fix bug in 1 component â†’ all paths benefit
- âœ… Component completion rates tracked independently

---

## Dependencies

**Blockers**: Story 22.1 must define persona paths

**Required**:
- React (functional components)
- React Confetti library
- TypeScript (strict typing)
- Event-driven architecture (custom events)

---

## Risks & Mitigation

### Risk 1: Components Too Generic (Don't Fit Personas)
**Mitigation**: Allow personaContext prop for customization

### Risk 2: Hard to Compose (Complex Dependencies)
**Mitigation**: Strict component isolation, clear interfaces

### Risk 3: Performance Issues (Too Many Components)
**Mitigation**: Lazy load components, render one at a time

---

## Definition of Done

- [ ] All acceptance criteria met
- [ ] 7 reusable components implemented
- [ ] 6 persona paths compose components correctly
- [ ] Component API documented
- [ ] Examples provided for each component
- [ ] Mobile responsive
- [ ] Analytics tracking per component
- [ ] No console errors
- [ ] Story marked as "Review" status

---

## Dev Agent Record

### Agent Model Used
[To be filled by dev agent]

### Completion Notes
[To be filled by dev agent]

### File List
```
src/components/Onboarding/TutorialComponents/
  index.ts
  TutorialModule.tsx
  QuickBeatCreation.tsx
  VisualMusicTheory.tsx
  ColorSequencer.tsx
  AccessibilityTour.tsx
  CollaborationDemo.tsx
  AdvancedFeatures.tsx
  PricingSupport.tsx
```

### Change Log
[To be filled by dev agent]

---

## Related Stories

- **Story 22.1**: Multi-Path Onboarding (defines persona paths that use these components)
- **Story 22.2**: AI Outreach Generator (references component completion analytics)
- **Story 22.3**: Referral Attribution (tracks which components convert best)

---

## Document Version

**Version**: 1.0
**Created**: 2025-10-25
**Last Updated**: 2025-10-25
**Status**: ðŸ“‹ **Draft - Ready for Development**
