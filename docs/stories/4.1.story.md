# Synthetic Frequency Visualization System

A comprehensive system for visualizing MIDI notes and drum hits as frequency data without requiring audio analysis.

## Overview

This system allows the visualizer to display clean, designed frequency representations based on musical events rather than actual audio analysis. Perfect for headless operation, educational visualization, and comparing theoretical vs. actual frequencies.

## Architecture

```
┌─────────────────────────────────────────────────────────────────┐
│                    Frequency Source Manager                      │
│                                                                   │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │ Microphone   │  │ MIDI Notes   │  │  Drum Hits   │          │
│  │ (Real Audio) │  │ (Synthetic)  │  │ (Synthetic)  │          │
│  └──────────────┘  └──────────────┘  └──────────────┘          │
│         │                 │                  │                   │
│         └─────────────────┴──────────────────┘                   │
│                           │                                      │
│                     Mix/Toggle                                   │
│                           │                                      │
│                    ┌──────▼───────┐                             │
│                    │ Mixed Output │                             │
│                    └──────────────┘                             │
└─────────────────────────────────────────────────────────────────┘
                             │
                    ┌────────▼────────┐
                    │   Visualizer    │
                    │ (Spectrum/      │
                    │  Ripple/Wave)   │
                    └─────────────────┘
```

## Components

### 1. Frequency Utils (`src/utils/frequencyUtils.ts`)
- `midiToFrequency(note)` - Convert MIDI note to Hz
- `getDrumFrequency(drumName)` - Get dominant frequency for drum
- `frequencyToBin()` - Convert Hz to FFT bin index

### 2. Synthetic Frequency Generator (`src/utils/syntheticFrequencyGenerator.ts`)
Creates artificial frequency spectrum data from note/drum events:
- Gaussian frequency peaks with configurable width
- Harmonic overtones (fundamental + harmonics)
- Time-based decay for natural feel
- Configurable FFT size and sample rate

### 3. Frequency Source Manager (`src/utils/frequencySourceManager.ts`)
Manages multiple input sources with mixing:

**Mix Modes:**
- `mic-only` - Real audio analysis only
- `midi-only` - MIDI note synthesis only
- `drums-only` - Drum hit synthesis only
- `mic+midi` - Blend microphone and MIDI
- `mic+drums` - Blend microphone and drums
- `midi+drums` - Blend MIDI and drums
- `all` - Mix all three sources

**Features:**
- Independent gain control per source (0-2x)
- Real-time mixing
- Automatic source enable/disable based on mode

### 4. Frequency Data Adapter (`src/components/LiveAudioVisualizer/FrequencyDataAdapter.ts`)
Provides unified interface for VisualizationEngine

## Usage

### From Drum Machine

```typescript
// Add drum hit to visualizer
const sourceManager = (window as any).frequencySourceManager;
if (sourceManager) {
  sourceManager.addDrumHit('Kick', 0.9); // drumName, velocity
}
```

### From MIDI System

```typescript
// Add MIDI note to visualizer
const sourceManager = (window as any).frequencySourceManager;
if (sourceManager) {
  sourceManager.addMidiNote(60, 0.8); // midiNote (middle C), velocity
}
```

### Changing Mix Mode

```typescript
sourceManager.setMixMode('drums-only'); // Show only drum frequencies
sourceManager.setMixMode('mic+drums');  // Overlay drums on microphone
```

### Adjusting Source Gains

```typescript
sourceManager.setSourceGain('microphone', 0.5); // 50% microphone
sourceManager.setSourceGain('drums', 1.5);      // 150% drums (boosted)
```

## Frequency Mappings

### Drums (Dominant Frequencies)
- **Kick**: 80 Hz → Red-orange
- **Snare**: 250 Hz → Orange
- **Tom**: 150 Hz → Orange-red
- **Clap**: 1500 Hz → Yellow-green
- **Hi-Hat**: 10000 Hz → Blue-violet
- **Crash**: 12000 Hz → Violet
- **Ride**: 4000 Hz → Cyan-green

### MIDI Notes
Standard tuning: A4 (MIDI 69) = 440 Hz
- C1 (MIDI 36) = 65.4 Hz → Red
- C4 (MIDI 60) = 261.6 Hz → Orange
- A4 (MIDI 69) = 440 Hz → Yellow
- C7 (MIDI 96) = 2093 Hz → Green-cyan

## Configuration

### Synthetic Generator Settings

```typescript
const config = {
  fftSize: 2048,          // FFT size (matches audio analyzer)
  sampleRate: 44100,      // Sample rate
  decayTime: 500,         // Note decay time (ms)
  peakWidth: 3,           // Frequency peak width (bins)
  harmonics: true,        // Include harmonic overtones
  harmonicCount: 5,       // Number of harmonics
  harmonicDecay: 0.5      // Harmonic amplitude decay
};
```

## Benefits

1. **Headless Operation** - Visualize without speaker output or microphone
2. **Clean Visualization** - No room acoustics, noise, or interference
3. **Educational** - Shows theoretical frequency content
4. **Comparison** - Overlay synthetic and real audio to see differences
5. **Performance** - No FFT analysis overhead for synthetic sources

## Integration Points

### Current Integration
- ✅ Frequency utilities
- ✅ Synthetic generators
- ✅ Source manager with mixing
- ✅ Frequency data adapter
- ⏳ UI controls (pending)
- ⏳ Drum machine integration (pending)

### Next Steps
1. Add UI controls to visualizer for source selection
2. Hook up drum machine to call `addDrumHit()`
3. Optional: Add MIDI input support
4. Optional: Add source gain sliders

## Example: Comparing Real vs Synthetic

```typescript
// Show what the kick SHOULD look like
sourceManager.setMixMode('drums-only');
sourceManager.addDrumHit('Kick', 1.0);

// Show what it ACTUALLY sounds like
sourceManager.setMixMode('mic-only');

// Show both together
sourceManager.setMixMode('mic+drums');
```

This allows you to see how close your drum synthesis is to the theoretical frequency, or visualize patterns even when audio is muted!
